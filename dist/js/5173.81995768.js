"use strict";(self["webpackChunkdata_v2"]=self["webpackChunkdata_v2"]||[]).push([[5173],{85173:function(e,t,a){a.r(t),a.d(t,{default:function(){return m}});var i=function(){var e=this,t=e._self._c;return t("a-spin",{attrs:{spinning:e.loading}},[t("a-form-model",{ref:"form",attrs:{model:e.entity,rules:e.rules,autocomplete:"off",layout:"vertical"}},[t("div",{staticClass:"card"},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{sm:6}},[t("a-form-model-item",{ref:"windowCode",attrs:{label:"时间窗编码",prop:"windowCode"}},[t("a-input",{attrs:{placeholder:"请输入时间窗编码",name:"windowCode",disabled:!!e.ndoEditParams.row},on:{change:e.inChange},model:{value:e.entity.windowCode,callback:function(t){e.$set(e.entity,"windowCode",t)},expression:"entity.windowCode"}})],1)],1),t("a-col",{attrs:{sm:6}},[t("a-form-model-item",{ref:"name",attrs:{label:"时间窗名称",prop:"name"}},[t("a-input",{attrs:{placeholder:"请输入时间窗名称",name:"name"},on:{change:e.inChange},model:{value:e.entity.name,callback:function(t){e.$set(e.entity,"name",t)},expression:"entity.name"}})],1)],1),t("a-col",{attrs:{sm:6}},[t("a-form-model-item",{ref:"timeWindowType",attrs:{label:"时间窗类型",prop:"timeWindowType"}},[t("a-select",{attrs:{placeholder:"请选择时间窗类型",name:"timeWindowType"},model:{value:e.entity.timeWindowType,callback:function(t){e.$set(e.entity,"timeWindowType",t)},expression:"entity.timeWindowType"}},[t("a-select-option",{attrs:{value:"生产时间窗"}},[e._v("生产时间窗")]),t("a-select-option",{attrs:{value:"质检时间窗"}},[e._v("质检时间窗")]),t("a-select-option",{attrs:{value:"物料供应时间窗"}},[e._v("物料供应时间窗")]),t("a-select-option",{attrs:{value:"设备维护时间窗"}},[e._v("设备维护时间窗")]),t("a-select-option",{attrs:{value:"车间作业时间窗"}},[e._v("车间作业时间窗")]),t("a-select-option",{attrs:{value:"交付时间窗"}},[e._v("交付时间窗")])],1)],1)],1),t("a-col",{attrs:{sm:6}},[t("a-form-model-item",{ref:"department",attrs:{label:"所属部门",prop:"department"}},[t("a-select",{attrs:{placeholder:"请选择所属部门",name:"department"},model:{value:e.entity.department,callback:function(t){e.$set(e.entity,"department",t)},expression:"entity.department"}},[t("a-select-option",{attrs:{value:"生产部"}},[e._v("生产部")]),t("a-select-option",{attrs:{value:"质量部"}},[e._v("质量部")]),t("a-select-option",{attrs:{value:"物料部"}},[e._v("物料部")]),t("a-select-option",{attrs:{value:"设备部"}},[e._v("设备部")]),t("a-select-option",{attrs:{value:"计划部"}},[e._v("计划部")]),t("a-select-option",{attrs:{value:"物流部"}},[e._v("物流部")])],1)],1)],1),t("a-col",{attrs:{sm:6}},[t("a-form-model-item",{ref:"priority",attrs:{label:"优先级",prop:"priority"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:1,max:10,placeholder:"请输入优先级",name:"priority"},model:{value:e.entity.priority,callback:function(t){e.$set(e.entity,"priority",t)},expression:"entity.priority"}})],1)],1),t("a-col",{attrs:{sm:6}},[t("a-form-model-item",{ref:"status",attrs:{label:"状态",prop:"status"}},[t("a-select",{attrs:{placeholder:"请选择状态",name:"status"},model:{value:e.entity.status,callback:function(t){e.$set(e.entity,"status",t)},expression:"entity.status"}},[t("a-select-option",{attrs:{value:"已启用"}},[e._v("已启用")]),t("a-select-option",{attrs:{value:"已禁用"}},[e._v("已禁用")]),t("a-select-option",{attrs:{value:"临时"}},[e._v("临时")]),t("a-select-option",{attrs:{value:"已过期"}},[e._v("已过期")])],1)],1)],1),t("a-col",{attrs:{sm:12}},[t("a-form-model-item",{ref:"description",attrs:{label:"时间窗描述",prop:"description"}},[t("a-textarea",{attrs:{placeholder:"请输入时间窗描述",rows:3,"max-length":500,name:"description"},model:{value:e.entity.description,callback:function(t){e.$set(e.entity,"description",t)},expression:"entity.description"}})],1)],1)],1)],1),t("g-collapse",{attrs:{headerName:"时间设置"},scopedSlots:e._u([{key:"content",fn:function(){return[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{sm:12}},[t("a-form-model-item",{ref:"repeatType",attrs:{label:"重复类型",prop:"repeatType"}},[t("a-select",{attrs:{placeholder:"请选择重复类型"},on:{change:e.handleRepeatTypeChange},model:{value:e.entity.repeatType,callback:function(t){e.$set(e.entity,"repeatType",t)},expression:"entity.repeatType"}},[t("a-select-option",{attrs:{value:"每天"}},[e._v("每天")]),t("a-select-option",{attrs:{value:"每周"}},[e._v("每周")]),t("a-select-option",{attrs:{value:"每月"}},[e._v("每月")]),t("a-select-option",{attrs:{value:"指定日期"}},[e._v("指定日期")]),t("a-select-option",{attrs:{value:"不重复"}},[e._v("不重复")])],1)],1)],1),"每周"===e.entity.repeatType?t("a-col",{attrs:{sm:12}},[t("a-form-model-item",{ref:"weekDays",attrs:{label:"每周几",prop:"weekDays"}},[t("a-checkbox-group",{model:{value:e.entity.weekDays,callback:function(t){e.$set(e.entity,"weekDays",t)},expression:"entity.weekDays"}},[t("a-checkbox",{attrs:{value:"1"}},[e._v("周一")]),t("a-checkbox",{attrs:{value:"2"}},[e._v("周二")]),t("a-checkbox",{attrs:{value:"3"}},[e._v("周三")]),t("a-checkbox",{attrs:{value:"4"}},[e._v("周四")]),t("a-checkbox",{attrs:{value:"5"}},[e._v("周五")]),t("a-checkbox",{attrs:{value:"6"}},[e._v("周六")]),t("a-checkbox",{attrs:{value:"0"}},[e._v("周日")])],1)],1)],1):e._e(),"每月"===e.entity.repeatType?t("a-col",{attrs:{sm:12}},[t("a-form-model-item",{ref:"monthDays",attrs:{label:"每月几号",prop:"monthDays"}},[t("a-select",{staticStyle:{width:"100%"},attrs:{mode:"multiple",placeholder:"请选择日期"},model:{value:e.entity.monthDays,callback:function(t){e.$set(e.entity,"monthDays",t)},expression:"entity.monthDays"}},e._l(31,(function(a){return t("a-select-option",{key:a,attrs:{value:a}},[e._v(" "+e._s(a)+"号 ")])})),1)],1)],1):e._e(),t("a-col",{attrs:{sm:12}},[t("a-form-model-item",{ref:"timeRange",attrs:{label:"时间段",prop:"timeRange"}},[t("a-time-picker",{staticStyle:{width:"48%","margin-right":"4%"},attrs:{format:"HH:mm",placeholder:"开始时间"},on:{change:e.updateTimeRange},model:{value:e.entity.startTime,callback:function(t){e.$set(e.entity,"startTime",t)},expression:"entity.startTime"}}),t("a-time-picker",{staticStyle:{width:"48%"},attrs:{format:"HH:mm",placeholder:"结束时间"},on:{change:e.updateTimeRange},model:{value:e.entity.endTime,callback:function(t){e.$set(e.entity,"endTime",t)},expression:"entity.endTime"}})],1)],1),t("a-col",{attrs:{sm:12}},[t("a-form-model-item",{ref:"effectiveDateRange",attrs:{label:"有效期",prop:"effectiveDateRange"}},[t("a-range-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD"},on:{change:e.updateEffectiveDate},model:{value:e.entity.effectiveDateRange,callback:function(t){e.$set(e.entity,"effectiveDateRange",t)},expression:"entity.effectiveDateRange"}})],1)],1)],1)]},proxy:!0}])}),t("g-collapse",{attrs:{headerName:"排除日期"},scopedSlots:e._u([{key:"content",fn:function(){return[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{sm:24}},[t("a-button",{staticClass:"add-exclude-btn",attrs:{type:"primary",icon:"plus"},on:{click:e.addExcludeDate}},[e._v("添加排除日期")])],1),t("a-col",{attrs:{sm:24}},[t("a-table",{attrs:{columns:e.excludeDateColumns,dataSource:e.entity.excludeDates,pagination:!1,size:"small",rowKey:"id"},scopedSlots:e._u([{key:"date",fn:function(a,i,s){return[t("a-date-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD",placeholder:"选择日期"},model:{value:e.entity.excludeDates[s].date,callback:function(t){e.$set(e.entity.excludeDates[s],"date",t)},expression:"entity.excludeDates[index].date"}})]}},{key:"reason",fn:function(a,i,s){return[t("a-input",{attrs:{placeholder:"请输入排除原因"},model:{value:e.entity.excludeDates[s].reason,callback:function(t){e.$set(e.entity.excludeDates[s],"reason",t)},expression:"entity.excludeDates[index].reason"}})]}},{key:"action",fn:function(a,i,s){return[t("a-button",{attrs:{type:"danger",icon:"delete",size:"small"},on:{click:()=>e.removeExcludeDate(s)}})]}}])})],1)],1)]},proxy:!0}])}),t("g-collapse",{attrs:{headerName:"适用对象"},scopedSlots:e._u([{key:"content",fn:function(){return[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{sm:24}},[t("a-button",{staticClass:"add-target-btn",attrs:{type:"primary",icon:"plus"},on:{click:e.addApplicableTarget}},[e._v("添加适用对象")])],1),t("a-col",{attrs:{sm:24}},[t("a-table",{attrs:{columns:e.applicableTargetColumns,dataSource:e.entity.applicableTargets,pagination:!1,size:"small",rowKey:"id"},scopedSlots:e._u([{key:"targetType",fn:function(a,i,s){return[t("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择对象类型"},model:{value:e.entity.applicableTargets[s].targetType,callback:function(t){e.$set(e.entity.applicableTargets[s],"targetType",t)},expression:"entity.applicableTargets[index].targetType"}},[t("a-select-option",{attrs:{value:"设备"}},[e._v("设备")]),t("a-select-option",{attrs:{value:"产品"}},[e._v("产品")]),t("a-select-option",{attrs:{value:"工序"}},[e._v("工序")]),t("a-select-option",{attrs:{value:"工作站"}},[e._v("工作站")]),t("a-select-option",{attrs:{value:"人员"}},[e._v("人员")])],1)]}},{key:"targetName",fn:function(a,i,s){return[t("a-input",{attrs:{placeholder:"请输入对象名称"},model:{value:e.entity.applicableTargets[s].targetName,callback:function(t){e.$set(e.entity.applicableTargets[s],"targetName",t)},expression:"entity.applicableTargets[index].targetName"}})]}},{key:"targetId",fn:function(a,i,s){return[t("a-input",{attrs:{placeholder:"请输入对象ID"},model:{value:e.entity.applicableTargets[s].targetId,callback:function(t){e.$set(e.entity.applicableTargets[s],"targetId",t)},expression:"entity.applicableTargets[index].targetId"}})]}},{key:"action",fn:function(a,i,s){return[t("a-button",{attrs:{type:"danger",icon:"delete",size:"small"},on:{click:()=>e.removeApplicableTarget(s)}})]}}])})],1)],1)]},proxy:!0}])}),t("g-collapse",{attrs:{headerName:"详细信息"},scopedSlots:e._u([{key:"content",fn:function(){return[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{sm:6}},[t("a-form-model-item",{attrs:{label:"创建人"}},[t("span",[e._v(e._s(e.entity.createdBy||"未知"))])])],1),t("a-col",{attrs:{sm:6}},[t("a-form-model-item",{attrs:{label:"创建时间"}},[t("span",[e._v(e._s(e.entity.createdTime||"未知"))])])],1),t("a-col",{attrs:{sm:6}},[t("a-form-model-item",{attrs:{label:"修改人"}},[t("span",[e._v(e._s(e.entity.modifiedBy||"未知"))])])],1),t("a-col",{attrs:{sm:6}},[t("a-form-model-item",{attrs:{label:"修改时间"}},[t("span",[e._v(e._s(e.entity.modifiedTime||"未知"))])])],1)],1)]},proxy:!0}])})],1)],1)},s=[],n=a(36026),r=a(30381),l=a.n(r),o={name:"CreateOrEditTimeWindow",mixins:[n.GE],data(){return{loading:!1,entity:{id:void 0,windowCode:"",name:"",timeWindowType:"",department:"",priority:5,description:"",repeatType:"每天",weekDays:[],monthDays:[],startTime:null,endTime:null,timeRange:"",effectiveDateRange:[],effectiveDate:"",excludeDates:[],applicableTargets:[],status:"已启用",createdBy:"",createdTime:"",modifiedBy:"",modifiedTime:""},rules:{windowCode:[{required:!0,message:"请输入时间窗编码",trigger:"change"},{pattern:/^TW\d{4}/,message:"时间窗编码格式不正确，应为TW开头加4位数字",trigger:"change"}],name:[{required:!0,message:"请输入时间窗名称",trigger:"change"},{pattern:/^[^\s]+(\s+[^\s]+)*$/,message:"时间窗名称不能包含前后空格",trigger:"change"}],timeWindowType:[{required:!0,message:"请选择时间窗类型",trigger:"change"}],department:[{required:!0,message:"请选择所属部门",trigger:"change"}],priority:[{required:!0,message:"请输入优先级",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}],repeatType:[{required:!0,message:"请选择重复类型",trigger:"change"}],weekDays:[{required:!0,message:"请选择每周几",trigger:"change",validator:(e,t,a)=>{"每周"!==this.entity.repeatType||t&&0!==t.length?a():a(new Error("请至少选择一天"))}}],monthDays:[{required:!0,message:"请选择每月几号",trigger:"change",validator:(e,t,a)=>{"每月"!==this.entity.repeatType||t&&0!==t.length?a():a(new Error("请至少选择一天"))}}],effectiveDateRange:[{required:!0,message:"请选择有效期",trigger:"change",validator:(e,t,a)=>{!t||t.length<2?a(new Error("请选择有效期范围")):a()}}]},excludeDateColumns:[{title:"日期",dataIndex:"date",key:"date",width:"40%",scopedSlots:{customRender:"date"}},{title:"排除原因",dataIndex:"reason",key:"reason",width:"50%",scopedSlots:{customRender:"reason"}},{title:"操作",key:"action",width:"10%",scopedSlots:{customRender:"action"}}],applicableTargetColumns:[{title:"对象类型",dataIndex:"targetType",key:"targetType",width:"25%",scopedSlots:{customRender:"targetType"}},{title:"对象名称",dataIndex:"targetName",key:"targetName",width:"35%",scopedSlots:{customRender:"targetName"}},{title:"对象ID",dataIndex:"targetId",key:"targetId",width:"30%",scopedSlots:{customRender:"targetId"}},{title:"操作",key:"action",width:"10%",scopedSlots:{customRender:"action"}}]}},methods:{init(){console.log(this.id,"初始化"),this.loading=!0,this.id?setTimeout((()=>{this.initFormData(),this.loading=!1}),500):(this.reset(),this.loading=!1)},resetFormData(){this.entity={id:void 0,windowCode:"",name:"",timeWindowType:"",department:"",priority:5,description:"",repeatType:"每天",weekDays:[],monthDays:[],startTime:null,endTime:null,timeRange:"",effectiveDateRange:[],effectiveDate:"",excludeDates:[],applicableTargets:[],status:"已启用",createdBy:"",createdTime:"",modifiedBy:"",modifiedTime:""}},initFormData(){if(this.ndoEditParams.row){const e=this.ndoEditParams.row;let t=null,a=null;if(e.timeRange){const i=e.timeRange.split(" - ");2===i.length&&(t=l()(i[0],"HH:mm"),a=l()(i[1],"HH:mm"))}let i=[];if(e.effectiveDate){const t=e.effectiveDate.split(" 至 ");2===t.length&&(i=[l()(t[0],"YYYY-MM-DD"),l()(t[1],"YYYY-MM-DD")])}this.entity={...this.entity,...e,startTime:t,endTime:a,effectiveDateRange:i,weekDays:e.weekDays||[],monthDays:e.monthDays||[],excludeDates:e.excludeDates||[],applicableTargets:e.applicableTargets||[]}}},async save(){this.updateTimeRange(),this.updateEffectiveDate();let e=await this.checkError();e&&(this.loading=!0,setTimeout((()=>{this.loading=!1,this.saveSuccess(this.entity.name),this.handleSaveEndBackView(this.id),this.refreshParent({reset:null})}),500))},inChange(e){console.log(e.target.value)},handleRepeatTypeChange(e){"每周"!==e&&(this.entity.weekDays=[]),"每月"!==e&&(this.entity.monthDays=[])},updateTimeRange(){if(this.entity.startTime&&this.entity.endTime){const e=l()(this.entity.startTime).format("HH:mm"),t=l()(this.entity.endTime).format("HH:mm");this.entity.timeRange=`${e} - ${t}`}else this.entity.timeRange=""},updateEffectiveDate(){if(this.entity.effectiveDateRange&&2===this.entity.effectiveDateRange.length){const e=l()(this.entity.effectiveDateRange[0]).format("YYYY-MM-DD"),t=l()(this.entity.effectiveDateRange[1]).format("YYYY-MM-DD");this.entity.effectiveDate=`${e} 至 ${t}`}else this.entity.effectiveDate=""},addExcludeDate(){this.entity.excludeDates.push({id:Date.now(),date:null,reason:""})},removeExcludeDate(e){this.entity.excludeDates.splice(e,1)},addApplicableTarget(){this.entity.applicableTargets.push({id:Date.now(),targetType:"",targetName:"",targetId:""})},removeApplicableTarget(e){this.entity.applicableTargets.splice(e,1)}}},c=o,d=a(1001),p=(0,d.Z)(c,i,s,!1,null,"21aef92c",null),m=p.exports}}]);
//# sourceMappingURL=5173.81995768.js.map