"use strict";(self["webpackChunkdata_v2"]=self["webpackChunkdata_v2"]||[]).push([[9578,6251],{66251:function(t,e,a){a.r(e),a.d(e,{default:function(){return c}});var i=function(){var t=this,e=t._self._c;return e("a-spin",{attrs:{spinning:t.loading}},[e("a-form-model",{ref:"form",attrs:{model:t.entity,rules:t.rules,autocomplete:"off",layout:"vertical"}},[e("div",{staticClass:"card"},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{ref:"bomCode",attrs:{label:"BOM编号",prop:"bomCode"}},[e("a-input",{attrs:{placeholder:"请输入BOM编号，格式为BOM加4位数字",disabled:!!t.ndoEditParams.row},on:{change:t.inChange},model:{value:t.entity.bomCode,callback:function(e){t.$set(t.entity,"bomCode",e)},expression:"entity.bomCode"}})],1)],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{ref:"productId",attrs:{label:"产品",prop:"productId"}},[e("a-select",{attrs:{placeholder:"请选择产品",disabled:!!t.ndoEditParams.row},on:{change:t.handleProductChange},model:{value:t.entity.productId,callback:function(e){t.$set(t.entity,"productId",e)},expression:"entity.productId"}},t._l(t.productList,(function(a){return e("a-select-option",{key:a.id,attrs:{value:a.id}},[t._v(" "+t._s(a.productCode)+" - "+t._s(a.name)+" ")])})),1)],1)],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{ref:"version",attrs:{label:"BOM版本",prop:"version"}},[e("a-input",{attrs:{placeholder:"请输入BOM版本"},on:{change:t.inChange},model:{value:t.entity.version,callback:function(e){t.$set(t.entity,"version",e)},expression:"entity.version"}})],1)],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{ref:"effectiveDate",attrs:{label:"生效日期",prop:"effectiveDate"}},[e("a-date-picker",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择生效日期"},model:{value:t.entity.effectiveDate,callback:function(e){t.$set(t.entity,"effectiveDate",e)},expression:"entity.effectiveDate"}})],1)],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{ref:"status",attrs:{label:"状态",prop:"status"}},[e("a-radio-group",{model:{value:t.entity.status,callback:function(e){t.$set(t.entity,"status",e)},expression:"entity.status"}},[e("a-radio",{attrs:{value:"启用"}},[t._v("启用")]),e("a-radio",{attrs:{value:"停用"}},[t._v("停用")])],1)],1)],1),e("a-col",{attrs:{sm:18}},[e("a-form-model-item",{ref:"remark",attrs:{label:"备注",prop:"remark"}},[e("a-textarea",{attrs:{placeholder:"请输入备注信息",rows:2},model:{value:t.entity.remark,callback:function(e){t.$set(t.entity,"remark",e)},expression:"entity.remark"}})],1)],1)],1)],1),e("g-collapse",{attrs:{headerName:"物料清单"},scopedSlots:t._u([{key:"content",fn:function(){return[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{sm:24}},[e("a-button",{staticStyle:{"margin-bottom":"16px"},attrs:{type:"primary",icon:"plus"},on:{click:t.addMaterial}},[t._v(" 添加物料 ")])],1),e("a-col",{attrs:{sm:24}},[e("a-table",{attrs:{columns:t.materialColumns,dataSource:t.entity.materials,pagination:!1,size:"small",rowKey:"id"},scopedSlots:t._u([{key:"materialCode",fn:function(a,i,s){return[e("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择物料"},on:{change:e=>t.handleMaterialChange(e,s)},model:{value:t.entity.materials[s].materialId,callback:function(e){t.$set(t.entity.materials[s],"materialId",e)},expression:"entity.materials[index].materialId"}},t._l(t.materialList,(function(a){return e("a-select-option",{key:a.id,attrs:{value:a.id}},[t._v(" "+t._s(a.materialCode)+" - "+t._s(a.name)+" ")])})),1)]}},{key:"quantity",fn:function(a,i,s){return[e("a-input-number",{staticStyle:{width:"100%"},attrs:{min:1,precision:0},model:{value:t.entity.materials[s].quantity,callback:function(e){t.$set(t.entity.materials[s],"quantity",e)},expression:"entity.materials[index].quantity"}})]}},{key:"position",fn:function(a,i,s){return[e("a-input",{attrs:{placeholder:"请输入安装位置"},model:{value:t.entity.materials[s].position,callback:function(e){t.$set(t.entity.materials[s],"position",e)},expression:"entity.materials[index].position"}})]}},{key:"remark",fn:function(a,i,s){return[e("a-input",{attrs:{placeholder:"请输入备注"},model:{value:t.entity.materials[s].remark,callback:function(e){t.$set(t.entity.materials[s],"remark",e)},expression:"entity.materials[index].remark"}})]}},{key:"action",fn:function(a,i,s){return[e("a-button",{attrs:{type:"danger",icon:"delete",size:"small"},on:{click:()=>t.removeMaterial(s)}})]}}])})],1)],1)]},proxy:!0}])}),e("g-collapse",{attrs:{headerName:"详细信息"},scopedSlots:t._u([{key:"content",fn:function(){return[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{attrs:{label:"创建人"}},[e("span",[t._v(t._s(t.entity.createdBy||"未知"))])])],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{attrs:{label:"创建时间"}},[e("span",[t._v(t._s(t.entity.createdTime||"未知"))])])],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{attrs:{label:"修改人"}},[e("span",[t._v(t._s(t.entity.modifiedBy||"未知"))])])],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{attrs:{label:"修改时间"}},[e("span",[t._v(t._s(t.entity.modifiedTime||"未知"))])])],1)],1)]},proxy:!0}])})],1)],1)},s=[],r=a(36026),n={name:"CreateOrEditProductBom",mixins:[r.GE],data(){return{loading:!1,entity:{id:void 0,bomCode:"",productId:void 0,productCode:"",productName:"",version:"",effectiveDate:null,status:"启用",remark:"",materials:[],createdBy:"",createdTime:"",modifiedBy:"",modifiedTime:""},rules:{bomCode:[{required:!0,message:"请输入BOM编号",trigger:"change"},{pattern:/^BOM\d{4}$/,message:"BOM编号必须为BOM加4位数字",trigger:"change"}],productId:[{required:!0,message:"请选择产品",trigger:"change"}],version:[{required:!0,message:"请输入BOM版本",trigger:"change"}],effectiveDate:[{required:!0,message:"请选择生效日期",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},materialColumns:[{title:"物料",dataIndex:"materialCode",width:"30%",scopedSlots:{customRender:"materialCode"}},{title:"数量",dataIndex:"quantity",width:"15%",scopedSlots:{customRender:"quantity"}},{title:"安装位置",dataIndex:"position",width:"20%",scopedSlots:{customRender:"position"}},{title:"备注",dataIndex:"remark",width:"25%",scopedSlots:{customRender:"remark"}},{title:"操作",key:"action",width:"10%",scopedSlots:{customRender:"action"}}],productList:[],materialList:[]}},created(){this.fetchProductList(),this.fetchMaterialList()},methods:{init(){console.log(this.id,"初始化"),this.loading=!0,this.id?setTimeout((()=>{this.initFormData(),this.loading=!1}),500):(this.reset(),this.loading=!1)},resetFormData(){this.entity={id:void 0,bomCode:"",productId:void 0,productCode:"",productName:"",version:"",effectiveDate:null,status:"启用",remark:"",materials:[],createdBy:"",createdTime:"",modifiedBy:"",modifiedTime:""}},initFormData(){if(this.ndoEditParams.row){const t=this.ndoEditParams.row;this.entity={...this.entity,...t,materials:t.materials||[]}}},async save(){let t=await this.checkError();if(t){if(0===this.entity.materials.length)return void this.$message.error("请至少添加一个物料");const t=this.entity.materials.find((t=>!t.materialId||!t.quantity));if(t)return void this.$message.error("请完善物料信息");this.loading=!0,setTimeout((()=>{this.loading=!1,this.saveSuccess(this.entity.bomCode),this.handleSaveEndBackView(this.id),this.refreshParent({reset:null})}),500)}},inChange(t){console.log(t.target.value)},fetchProductList(){setTimeout((()=>{this.productList=Array.from({length:10},((t,e)=>({id:e+1,productCode:`P${String(e+1).padStart(4,"0")}`,name:`产品${e+1}`})))}),500)},fetchMaterialList(){setTimeout((()=>{this.materialList=Array.from({length:20},((t,e)=>({id:e+1,materialCode:`M${String(e+1).padStart(4,"0")}`,name:`物料${e+1}`})))}),500)},handleProductChange(t){const e=this.productList.find((e=>e.id===t));e&&(this.entity.productCode=e.productCode,this.entity.productName=e.name)},addMaterial(){this.entity.materials.push({id:Date.now(),materialId:void 0,materialCode:"",materialName:"",quantity:1,position:"",remark:""})},removeMaterial(t){this.entity.materials.splice(t,1)},handleMaterialChange(t,e){const a=this.materialList.find((e=>e.id===t));a&&(this.entity.materials[e].materialCode=a.materialCode,this.entity.materials[e].materialName=a.name)}}},o=n,d=a(1001),l=(0,d.Z)(o,i,s,!1,null,"1608436a",null),c=l.exports},49578:function(t,e,a){a.r(e),a.d(e,{default:function(){return m}});var i=function(){var t=this,e=t._self._c;return e("g-body-layout",{attrs:{pageIndex:t.pageNumber,pageSize:t.pageSize,total:t.total,filterText:t.filterText},on:{"update:filterText":function(e){t.filterText=e},"update:filter-text":function(e){t.filterText=e},pageIndexChange:t.pageIndexChange,pageSizeChange:t.pageSizeChange,suffixSearchCallback:t.onFilterReady},scopedSlots:t._u([{key:"btnGroup",fn:function(){return[e("g-btn-group",{attrs:{buttonLists:t.btnList},on:{btnCallBack:t.btnGroupClick}})]},proxy:!0},{key:"table",fn:function(){return[e("g-ndo-table",{attrs:{id:t.id,handName:"产品BOM",dataList:t.dataList,isTableLoading:t.loading,total:t.total},on:{rowClick:t.rowClick}})]},proxy:!0},{key:"content",fn:function(){return[t.isShowEdit?e("create-or-edit-product-bom",{attrs:{ndoEditParams:t.ndoEditParams,refreshTag:t.refreshTag,saveTag:t.saveTag,resetTag:t.resetTag},on:{childRefresh:function(e){return t.childRefresh(e)},rowClick:function(e){return t.rowClick(e)}}}):e("g-empty")]},proxy:!0}])})},s=[],r=a(36026),n=a(66251),o={name:"ProductBom",mixins:[r.He],components:{CreateOrEditProductBom:n["default"]},data(){return{filterText:"",isTableLoading:!1,dataSource:[],columns:[{title:"BOM编号",dataIndex:"bomCode",width:120},{title:"产品编码",dataIndex:"productCode",width:120},{title:"产品名称",dataIndex:"productName",width:150},{title:"BOM版本",dataIndex:"version",width:100},{title:"物料数量",dataIndex:"materialCount",width:100},{title:"状态",dataIndex:"status",width:100,scopedSlots:{customRender:"status"}},{title:"生效日期",dataIndex:"effectiveDate",width:120},{title:"备注",dataIndex:"remark"},{title:"创建人",dataIndex:"createdBy",width:100},{title:"创建时间",dataIndex:"createdTime",width:150}],buttonList:[]}},created(){this.getBtnList()},mounted(){},methods:{getBtnList(){this.btnList=[{text:this.AppConst.button.create,icon:this.AppConst.icon.create,eventName:this.AppConst.button.create,display:!0},{text:this.AppConst.button.copy,icon:this.AppConst.icon.copy,eventName:this.AppConst.button.copy,display:!!this.id},{text:this.AppConst.button.delete,icon:this.AppConst.icon.delete,eventName:this.AppConst.button.delete,display:!!this.id},{text:this.AppConst.button.refresh,icon:this.AppConst.icon.refresh,eventName:this.AppConst.button.refresh,right:!0,display:this.isShowEdit},{text:this.AppConst.button.save,icon:this.AppConst.icon.save,eventName:this.AppConst.button.save,right:!0,type:"primary",display:this.isShowEdit}]},handleButtonClick(t){switch(t){case"add":this.handleAdd();break;case"edit":this.handleEdit();break;case"delete":this.handleDelete();break;case"enable":this.handleStatusChange("启用");break;case"disable":this.handleStatusChange("停用");break}},handleAdd(){this.$router.push({name:"CreateOrEditProductBom"})},handleEdit(){const t=this.selectedRows[0];this.$router.push({name:"CreateOrEditProductBom",query:{id:t.id}})},handleDelete(){const t=this.selectedRows.map((t=>t.id));this.$confirm({title:"确认删除",content:"是否确认删除选中的BOM记录？",onOk:()=>{console.log("删除的ID：",t),this.fetchData()}})},handleStatusChange(t){const e=this.selectedRows.map((t=>t.id));this.$confirm({title:`确认${t}`,content:`是否确认${t}选中的BOM记录？`,onOk:()=>{console.log("更新状态的ID：",e,t),this.fetchData()}})},onSearch(){this.fetchData()},fetchData(t){this.isTableLoading=!0,setTimeout((()=>{t.finishedCallback();let e=[];for(let t=0;t<10;t++)e.push({id:t+1,bomCode:`BOM${String(t+1).padStart(4,"0")}`,productCode:`P${String(t+1).padStart(4,"0")}`,name:`产品${t+1}`,version:`V1.${t}`,materialCount:Math.floor(20*Math.random())+1,status:t%2===0?"启用":"停用",effectiveDate:"2024-03-15",remark:`这是产品${t+1}的BOM说明`,createdBy:"管理员",createdTime:"2024-03-15 12:00:00"});t.successCallback({items:e,totalCount:2*e.length})}),1e3)},handleTableChange(t){this.fetchData()},handleSelectionChange(t,e){this.selectedRowKeys=t,this.selectedRows=e,this.buttonList=this.buttonList.map((e=>(["edit","delete"].includes(e.key)?e.disabled=1!==t.length:["enable","disable"].includes(e.key)&&(e.disabled=0===t.length),e)))}}},d=o,l=a(1001),c=(0,l.Z)(d,i,s,!1,null,"46962e7b",null),m=c.exports}}]);
//# sourceMappingURL=9578.c8b243d5.js.map