"use strict";(self["webpackChunkdata_v2"]=self["webpackChunkdata_v2"]||[]).push([[5763],{75763:function(t,i,e){e.r(i),e.d(i,{default:function(){return u}});var s=function(){var t=this,i=t._self._c;return i("div",{attrs:{id:"formulaPage"}},[i("div",{ref:"formulaView",staticClass:"formulaView",attrs:{id:"formulaView"},on:{click:function(i){return i.stopPropagation(),t.recordPosition()}}},t._l(t.formulaList,(function(e,s){return i("div",{key:s,staticClass:"content-item",on:{click:function(i){return i.stopPropagation(),t.recordPosition(s)}}},["num"==e.type?i("div",{staticClass:"num"},[t._v(" ‍"+t._s(e.value)+" ")]):"plain"==e.type?i("div",{staticClass:"plain"},[t._v(" ‍"+t._s(e.value)+" ")]):"obj"==e.type?i("div",{staticClass:"obj"},[t._v(" ‍"+t._s(e.value)+" ")]):t._e(),e.cursor?i("div",{staticClass:"cursor"}):t._e()])})),0),i("div",{staticClass:"formula-controls mt_10"},[i("div",{staticClass:"operator-group"},t._l(t.operatorList,(function(e){return i("a-button",{key:e.id,staticClass:"operator-btn",on:{click:function(i){return t.addItem(e.id,"plain")}}},[t._v(" "+t._s(e.name)+" ")])})),1),i("div",{staticClass:"data-tags"},[i("div",{staticClass:"tag-group"},t._l(t.dataList,(function(e){return i("a-tag",{key:e.id,staticClass:"data-tag",on:{click:function(i){return t.addItem(e.id,"obj")}}},[t._v(" "+t._s(e.name)+" ")])})),1)]),i("div",{staticClass:"clear-btn"},[i("a-button",{attrs:{type:"link"},on:{click:function(i){return t.clearAll()}}},[t._v("清除全部")])],1)])])},a=[],o={name:"",props:{},data:function(){return{formulaStr:"",dataId:"",operatorId:"",formulaList:[],operatorList:[{name:"+",id:"+"},{name:"-",id:"-"},{name:"*",id:"*"},{name:"/",id:"/"}],dataList:[{name:"指标1",id:"1"},{name:"指标2",id:"2"},{name:"指标3",id:"3"}],defaultList:[{name:"指标1",id:"1"}],isClickData:!1}},watch:{formulaList(t){this.$emit("change",t)}},created(){this.$nextTick((function(){document.addEventListener("keydown",this.keydown,!1),document.addEventListener("click",this.formulaBlur)}))},destroyed(){document.removeEventListener("keydown",this.keydown,!1),document.removeEventListener("click",this.formulaBlur)},methods:{getFormula:function(){},recordPosition(t){this.formulaList&&this.formulaList.length>0?this.formulaList=this.formulaList.map(((i,e)=>(i.cursor=!1,t>-1&&t==e?i.cursor=!0:0===t||t||e!=this.formulaList.length-1||(i.cursor=!0),i))):this.formulaList=[{cursor:!0,type:"placeholder",value:""}]},formulaBlur(t){this.isClickData||(this.formulaList=this.formulaList?.map((t=>(t.cursor=!1,t))))},addItem:function(t,i,e=!0){if(!t)return!1;this.isClickData="obj"===i,setTimeout((()=>{this.isClickData=!1}),100);let s=this;if("obj"===i&&this.formulaList&&this.formulaList.length>0){this.recordPosition(this.formulaList.length-1);let t=this.formulaList.findIndex((t=>t.cursor));if(-1!==t){let i=this.formulaList[t];if(i&&"plain"!==i.type&&"placeholder"!==i.type){let i={value:"-",key:"-",type:"plain"};this.formulaList.splice(t+1,0,i),this.recordPosition(t+1)}}}"plain"==i&&"()"==t&&(t="(",setTimeout((function(){s.addItem(")",i,!1)}),50));let a={},o={value:"",key:t,type:i};if("obj"==i?(a=this.dataList?.find((i=>i.id==t)),o.value=a.name):o.value=t,this.formulaList&&this.formulaList.length>0){const t=this.formulaList.length;for(let i=0;i<t;i++){if(this.formulaList[i].cursor){this.formulaList.splice(i+1,0,o),e&&this.recordPosition(i+1);break}i===this.formulaList.length-1&&(this.formulaList.push(o),this.recordPosition(this.formulaList.length-1))}}else this.formulaList||(this.formulaList=[]),this.formulaList.push(o),this.recordPosition(this.formulaList.length-1)},clearAll(){this.formulaList=[];let t=this;setTimeout((function(){t.recordPosition()}),100)},deleteItem(t){let i=JSON.parse(JSON.stringify(this.formulaList)),e=null;const s=i?.length;for(let a=0;a<s;a++)if(i[a].cursor&&i[a].key){e=a,"del"==t&&(e=a+1),e>-1&&(this.formulaList.splice(e,1),"del"==t||this.recordPosition(e-1));break}},keydown(t){let i,e=this.formulaList?.find(((t,e)=>(t.cursor&&(i=e),t.cursor)));if(!e)return!1;if(t&&[37,39].includes(t.keyCode))37==t.keyCode?i-=1:i+=1,i>-1&&i<this.formulaList.length&&this.recordPosition(i);else if(t&&8==t.keyCode)this.deleteItem();else if(t&&[107,109,106,111].includes(t.keyCode))this.addItem(t.key,"plain");else if(t&&t.shiftKey&&[48,57].includes(t.keyCode))this.addItem(t.key,"num");else if(t&&46==t.keyCode)this.deleteItem("del");else{document.returnValue=!1;var s=/^([0-9]{1}[0-9]{0,7})$/;s.test(t.key)&&this.addItem(t.key,"num")}},parsingFormula:function(t){let i="",e=[];return e=this.formulaList?.map((t=>{let e=t.key;return e&&("obj"==t.type&&(e="["+e+"]"),i+=e),e})),i},formatValidation(){let t=null,i=this.formulaList?.filter((i=>("obj"==i.type&&(t=i),i.key))),e={type:!0,mag:""};if(t)for(let s=0;s<i.length;s++)s<i.length-1&&"obj"==i[s].type&&"plain"==i[s+1].type&&(e.mag="指标后缀");else e.mag="至少添加一个指标";return e.mag&&(e.type=!1),e}}},r=o,l=e(1001),n=(0,l.Z)(r,s,a,!1,null,null,null),u=n.exports}}]);
//# sourceMappingURL=5763.d6ba81e6.js.map