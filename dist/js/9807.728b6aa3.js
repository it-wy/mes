"use strict";(self["webpackChunkdata_v2"]=self["webpackChunkdata_v2"]||[]).push([[9807],{74802:function(t,e,a){a.r(e),a.d(e,{default:function(){return d}});var o=function(){var t=this,e=t._self._c;return e("a-spin",{attrs:{spinning:t.loading}},[e("a-form-model",{ref:"form",attrs:{model:t.entity,rules:t.rules,autocomplete:"off",layout:"vertical"}},[e("div",{staticClass:"card"},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{ref:"collectionCode",attrs:{label:"采集编码",prop:"collectionCode"}},[e("a-input",{attrs:{placeholder:"请输入采集编码",name:"collectionCode",disabled:!!t.ndoEditParams.row},on:{change:t.inChange},model:{value:t.entity.collectionCode,callback:function(e){t.$set(t.entity,"collectionCode",e)},expression:"entity.collectionCode"}})],1)],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{ref:"name",attrs:{label:"采集名称",prop:"name"}},[e("a-input",{attrs:{placeholder:"请输入采集名称",name:"name"},on:{change:t.inChange},model:{value:t.entity.name,callback:function(e){t.$set(t.entity,"name",e)},expression:"entity.name"}})],1)],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{ref:"collectionType",attrs:{label:"采集类型",prop:"collectionType"}},[e("a-select",{attrs:{placeholder:"请选择采集类型",name:"collectionType"},model:{value:t.entity.collectionType,callback:function(e){t.$set(t.entity,"collectionType",e)},expression:"entity.collectionType"}},[e("a-select-option",{attrs:{value:"设备数据采集"}},[t._v("设备数据采集")]),e("a-select-option",{attrs:{value:"生产过程采集"}},[t._v("生产过程采集")]),e("a-select-option",{attrs:{value:"质量检测采集"}},[t._v("质量检测采集")]),e("a-select-option",{attrs:{value:"工艺参数采集"}},[t._v("工艺参数采集")]),e("a-select-option",{attrs:{value:"环境数据采集"}},[t._v("环境数据采集")])],1)],1)],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{ref:"deviceType",attrs:{label:"设备类型",prop:"deviceType"}},[e("a-select",{attrs:{placeholder:"请选择设备类型",name:"deviceType"},model:{value:t.entity.deviceType,callback:function(e){t.$set(t.entity,"deviceType",e)},expression:"entity.deviceType"}},[e("a-select-option",{attrs:{value:"传感器"}},[t._v("传感器")]),e("a-select-option",{attrs:{value:"PLC"}},[t._v("PLC")]),e("a-select-option",{attrs:{value:"仪表"}},[t._v("仪表")]),e("a-select-option",{attrs:{value:"摄像头"}},[t._v("摄像头")]),e("a-select-option",{attrs:{value:"控制器"}},[t._v("控制器")])],1)],1)],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{ref:"protocol",attrs:{label:"通信协议",prop:"protocol"}},[e("a-select",{attrs:{placeholder:"请选择通信协议",name:"protocol"},on:{change:t.handleProtocolChange},model:{value:t.entity.protocol,callback:function(e){t.$set(t.entity,"protocol",e)},expression:"entity.protocol"}},[e("a-select-option",{attrs:{value:"Modbus"}},[t._v("Modbus")]),e("a-select-option",{attrs:{value:"OPC UA"}},[t._v("OPC UA")]),e("a-select-option",{attrs:{value:"MQTT"}},[t._v("MQTT")]),e("a-select-option",{attrs:{value:"HTTP"}},[t._v("HTTP")]),e("a-select-option",{attrs:{value:"TCP/IP"}},[t._v("TCP/IP")])],1)],1)],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{ref:"status",attrs:{label:"状态",prop:"status"}},[e("a-select",{attrs:{placeholder:"请选择状态",name:"status"},model:{value:t.entity.status,callback:function(e){t.$set(t.entity,"status",e)},expression:"entity.status"}},[e("a-select-option",{attrs:{value:"已启用"}},[t._v("已启用")]),e("a-select-option",{attrs:{value:"已禁用"}},[t._v("已禁用")]),e("a-select-option",{attrs:{value:"配置中"}},[t._v("配置中")]),e("a-select-option",{attrs:{value:"异常"}},[t._v("异常")])],1)],1)],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{ref:"frequencyValue",attrs:{label:"采集频率(秒/次)",prop:"frequencyValue"}},[e("a-select",{attrs:{placeholder:"请选择采集频率",name:"frequencyValue"},model:{value:t.entity.frequencyValue,callback:function(e){t.$set(t.entity,"frequencyValue",e)},expression:"entity.frequencyValue"}},[e("a-select-option",{attrs:{value:1}},[t._v("1秒/次")]),e("a-select-option",{attrs:{value:5}},[t._v("5秒/次")]),e("a-select-option",{attrs:{value:10}},[t._v("10秒/次")]),e("a-select-option",{attrs:{value:30}},[t._v("30秒/次")]),e("a-select-option",{attrs:{value:60}},[t._v("60秒/次")])],1)],1)],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{attrs:{label:"上次采集时间"}},[e("span",[t._v(t._s(t.entity.lastCollectTime||"无"))])])],1),e("a-col",{attrs:{sm:12}},[e("a-form-model-item",{ref:"description",attrs:{label:"描述",prop:"description"}},[e("a-textarea",{attrs:{placeholder:"请输入描述信息",rows:3,"max-length":500,name:"description"},model:{value:t.entity.description,callback:function(e){t.$set(t.entity,"description",e)},expression:"entity.description"}})],1)],1)],1)],1),e("g-collapse",{attrs:{headerName:"连接设置"},scopedSlots:t._u([{key:"content",fn:function(){return[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{ref:"ipAddress",attrs:{label:"IP地址",prop:"ipAddress"}},[e("a-input",{attrs:{placeholder:"请输入IP地址",name:"ipAddress"},model:{value:t.entity.ipAddress,callback:function(e){t.$set(t.entity,"ipAddress",e)},expression:"entity.ipAddress"}})],1)],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{ref:"port",attrs:{label:"端口",prop:"port"}},[e("a-input-number",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入端口",min:1,max:65535},model:{value:t.entity.port,callback:function(e){t.$set(t.entity,"port",e)},expression:"entity.port"}})],1)],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{ref:"timeout",attrs:{label:"超时时间(秒)",prop:"timeout"}},[e("a-input-number",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入超时时间",min:1,max:300},model:{value:t.entity.timeout,callback:function(e){t.$set(t.entity,"timeout",e)},expression:"entity.timeout"}})],1)],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{ref:"retryCount",attrs:{label:"重试次数",prop:"retryCount"}},[e("a-input-number",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入重试次数",min:0,max:10},model:{value:t.entity.retryCount,callback:function(e){t.$set(t.entity,"retryCount",e)},expression:"entity.retryCount"}})],1)],1),"OPC UA"===t.entity.protocol||"MQTT"===t.entity.protocol?[e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{ref:"username",attrs:{label:"用户名",prop:"username"}},[e("a-input",{attrs:{placeholder:"请输入用户名",name:"username"},model:{value:t.entity.username,callback:function(e){t.$set(t.entity,"username",e)},expression:"entity.username"}})],1)],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{ref:"password",attrs:{label:"密码",prop:"password"}},[e("a-input-password",{attrs:{placeholder:"请输入密码",name:"password"},model:{value:t.entity.password,callback:function(e){t.$set(t.entity,"password",e)},expression:"entity.password"}})],1)],1)]:t._e(),"Modbus"===t.entity.protocol?[e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{ref:"slaveId",attrs:{label:"从站ID",prop:"slaveId"}},[e("a-input-number",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入从站ID",min:1,max:255},model:{value:t.entity.slaveId,callback:function(e){t.$set(t.entity,"slaveId",e)},expression:"entity.slaveId"}})],1)],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{ref:"functionCode",attrs:{label:"功能码",prop:"functionCode"}},[e("a-select",{attrs:{placeholder:"请选择功能码",name:"functionCode"},model:{value:t.entity.functionCode,callback:function(e){t.$set(t.entity,"functionCode",e)},expression:"entity.functionCode"}},[e("a-select-option",{attrs:{value:"1"}},[t._v("01 - 读线圈")]),e("a-select-option",{attrs:{value:"2"}},[t._v("02 - 读离散输入")]),e("a-select-option",{attrs:{value:"3"}},[t._v("03 - 读保持寄存器")]),e("a-select-option",{attrs:{value:"4"}},[t._v("04 - 读输入寄存器")])],1)],1)],1)]:t._e()],2),"HTTP"===t.entity.protocol?e("a-row",[e("a-col",{attrs:{sm:12}},[e("a-form-model-item",{ref:"urlPath",attrs:{label:"URL路径",prop:"urlPath"}},[e("a-input",{attrs:{placeholder:"请输入URL路径",name:"urlPath"},model:{value:t.entity.urlPath,callback:function(e){t.$set(t.entity,"urlPath",e)},expression:"entity.urlPath"}})],1)],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{ref:"httpMethod",attrs:{label:"请求方法",prop:"httpMethod"}},[e("a-select",{attrs:{placeholder:"请选择请求方法",name:"httpMethod"},model:{value:t.entity.httpMethod,callback:function(e){t.$set(t.entity,"httpMethod",e)},expression:"entity.httpMethod"}},[e("a-select-option",{attrs:{value:"GET"}},[t._v("GET")]),e("a-select-option",{attrs:{value:"POST"}},[t._v("POST")]),e("a-select-option",{attrs:{value:"PUT"}},[t._v("PUT")])],1)],1)],1)],1):t._e()]},proxy:!0}])}),e("g-collapse",{attrs:{headerName:"数据点配置"},scopedSlots:t._u([{key:"content",fn:function(){return[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{sm:24}},[e("a-button",{staticClass:"add-point-btn",attrs:{type:"primary",icon:"plus"},on:{click:t.addDataPoint}},[t._v("添加数据点")])],1),e("a-col",{attrs:{sm:24}},[e("a-table",{attrs:{columns:t.dataPointColumns,dataSource:t.entity.dataPoints,pagination:!1,size:"small",rowKey:"id"},scopedSlots:t._u([{key:"pointName",fn:function(a,o,s){return[e("a-input",{attrs:{placeholder:"请输入数据点名称"},model:{value:t.entity.dataPoints[s].pointName,callback:function(e){t.$set(t.entity.dataPoints[s],"pointName",e)},expression:"entity.dataPoints[index].pointName"}})]}},{key:"address",fn:function(a,o,s){return[e("a-input",{attrs:{placeholder:"请输入地址/标签"},model:{value:t.entity.dataPoints[s].address,callback:function(e){t.$set(t.entity.dataPoints[s],"address",e)},expression:"entity.dataPoints[index].address"}})]}},{key:"dataType",fn:function(a,o,s){return[e("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择数据类型"},model:{value:t.entity.dataPoints[s].dataType,callback:function(e){t.$set(t.entity.dataPoints[s],"dataType",e)},expression:"entity.dataPoints[index].dataType"}},[e("a-select-option",{attrs:{value:"Int"}},[t._v("Int")]),e("a-select-option",{attrs:{value:"Float"}},[t._v("Float")]),e("a-select-option",{attrs:{value:"Boolean"}},[t._v("Boolean")]),e("a-select-option",{attrs:{value:"String"}},[t._v("String")])],1)]}},{key:"unit",fn:function(a,o,s){return[e("a-input",{attrs:{placeholder:"请输入单位"},model:{value:t.entity.dataPoints[s].unit,callback:function(e){t.$set(t.entity.dataPoints[s],"unit",e)},expression:"entity.dataPoints[index].unit"}})]}},{key:"description",fn:function(a,o,s){return[e("a-input",{attrs:{placeholder:"请输入描述"},model:{value:t.entity.dataPoints[s].description,callback:function(e){t.$set(t.entity.dataPoints[s],"description",e)},expression:"entity.dataPoints[index].description"}})]}},{key:"action",fn:function(a,o,s){return[e("a-button",{attrs:{type:"danger",icon:"delete",size:"small"},on:{click:()=>t.removeDataPoint(s)}})]}}])})],1)],1)]},proxy:!0}])}),e("g-collapse",{attrs:{headerName:"详细信息"},scopedSlots:t._u([{key:"content",fn:function(){return[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{attrs:{label:"创建人"}},[e("span",[t._v(t._s(t.entity.createdBy||"未知"))])])],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{attrs:{label:"创建时间"}},[e("span",[t._v(t._s(t.entity.createdTime||"未知"))])])],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{attrs:{label:"修改人"}},[e("span",[t._v(t._s(t.entity.modifiedBy||"未知"))])])],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{attrs:{label:"修改时间"}},[e("span",[t._v(t._s(t.entity.modifiedTime||"未知"))])])],1)],1)]},proxy:!0}])})],1)],1)},s=[],n=a(36026),i={name:"CreateOrEditDataCollection",mixins:[n.GE],data(){return{loading:!1,entity:{id:void 0,collectionCode:"",name:"",collectionType:"",deviceType:"",protocol:"",frequencyValue:5,frequency:"5秒/次",ipAddress:"",port:502,timeout:10,retryCount:3,username:"",password:"",slaveId:1,functionCode:"3",urlPath:"",httpMethod:"GET",dataPoints:[],description:"",lastCollectTime:"",status:"配置中",createdBy:"",createdTime:"",modifiedBy:"",modifiedTime:""},rules:{collectionCode:[{required:!0,message:"请输入采集编码",trigger:"change"},{pattern:/^DC\d{4}$/,message:"采集编码格式不正确，应为DC开头加4位数字",trigger:"change"}],name:[{required:!0,message:"请输入采集名称",trigger:"change"},{pattern:/^[^\s]+(\s+[^\s]+)*$/,message:"采集名称不能包含前后空格",trigger:"change"}],collectionType:[{required:!0,message:"请选择采集类型",trigger:"change"}],deviceType:[{required:!0,message:"请选择设备类型",trigger:"change"}],protocol:[{required:!0,message:"请选择通信协议",trigger:"change"}],frequencyValue:[{required:!0,message:"请选择采集频率",trigger:"change"}],ipAddress:[{required:!0,message:"请输入IP地址",trigger:"change"},{pattern:/^(\d{1,3}\.){3}\d{1,3}$/,message:"IP地址格式不正确",trigger:"change"}],port:[{required:!0,message:"请输入端口",trigger:"change"},{type:"number",min:1,max:65535,message:"端口范围为1-65535",trigger:"change"}],timeout:[{required:!0,message:"请输入超时时间",trigger:"change"},{type:"number",min:1,max:300,message:"超时时间范围为1-300秒",trigger:"change"}],slaveId:[{required:!0,message:"请输入从站ID",trigger:"change"},{type:"number",min:1,max:255,message:"从站ID范围为1-255",trigger:"change"}],functionCode:[{required:!0,message:"请选择功能码",trigger:"change"}],urlPath:[{required:!0,message:"请输入URL路径",trigger:"change"}],httpMethod:[{required:!0,message:"请选择请求方法",trigger:"change"}]},dataPointColumns:[{title:"数据点名称",dataIndex:"pointName",key:"pointName",width:"20%",scopedSlots:{customRender:"pointName"}},{title:"地址/标签",dataIndex:"address",key:"address",width:"15%",scopedSlots:{customRender:"address"}},{title:"数据类型",dataIndex:"dataType",key:"dataType",width:"15%",scopedSlots:{customRender:"dataType"}},{title:"单位",dataIndex:"unit",key:"unit",width:"10%",scopedSlots:{customRender:"unit"}},{title:"描述",dataIndex:"description",key:"description",width:"30%",scopedSlots:{customRender:"description"}},{title:"操作",key:"action",width:"10%",scopedSlots:{customRender:"action"}}]}},methods:{init(){console.log(this.id,"初始化"),this.loading=!0,this.id?setTimeout((()=>{this.initFormData(),this.loading=!1}),500):(this.reset(),this.loading=!1)},resetFormData(){this.entity={id:void 0,collectionCode:"",name:"",collectionType:"",deviceType:"",protocol:"",frequencyValue:5,frequency:"5秒/次",ipAddress:"",port:502,timeout:10,retryCount:3,username:"",password:"",slaveId:1,functionCode:"3",urlPath:"",httpMethod:"GET",dataPoints:[],description:"",lastCollectTime:"",status:"配置中",createdBy:"",createdTime:"",modifiedBy:"",modifiedTime:""}},initFormData(){if(this.ndoEditParams.row){const t=this.ndoEditParams.row;let e=5;if(t.frequency){const a=t.frequency.match(/(\d+)/);a&&(e=parseInt(a[1]))}let a=[];if(t.dataPoints)if("number"===typeof t.dataPoints)for(let o=0;o<t.dataPoints;o++)a.push({id:Date.now()+o,pointName:`数据点${o+1}`,address:`addr${o+1}`,dataType:o%2?"Int":"Float",unit:o%3?"℃":o%4?"MPa":"%",description:`数据点${o+1}描述`});else Array.isArray(t.dataPoints)&&(a=t.dataPoints);this.entity={...this.entity,...t,frequencyValue:e,dataPoints:a}}},async save(){this.entity.frequency=`${this.entity.frequencyValue}秒/次`;let t=await this.checkError();t&&(this.loading=!0,setTimeout((()=>{this.loading=!1,this.saveSuccess(this.entity.name),this.handleSaveEndBackView(this.id),this.refreshParent({reset:null})}),500))},inChange(t){console.log(t.target.value)},addDataPoint(){this.entity.dataPoints.push({id:Date.now(),pointName:"",address:"",dataType:"Float",unit:"",description:""})},removeDataPoint(t){this.entity.dataPoints.splice(t,1)},handleProtocolChange(t){switch(t){case"Modbus":this.entity.port=502;break;case"OPC UA":this.entity.port=4840;break;case"MQTT":this.entity.port=1883;break;case"HTTP":this.entity.port=80;break;case"TCP/IP":this.entity.port=9600;break;default:this.entity.port=502}}}},r=i,l=a(1001),c=(0,l.Z)(r,o,s,!1,null,"0c0b770c",null),d=c.exports}}]);
//# sourceMappingURL=9807.728b6aa3.js.map