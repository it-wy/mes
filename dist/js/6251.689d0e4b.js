"use strict";(self["webpackChunkdata_v2"]=self["webpackChunkdata_v2"]||[]).push([[6251],{66251:function(t,e,a){a.r(e),a.d(e,{default:function(){return m}});var i=function(){var t=this,e=t._self._c;return e("a-spin",{attrs:{spinning:t.loading}},[e("a-form-model",{ref:"form",attrs:{model:t.entity,rules:t.rules,autocomplete:"off",layout:"vertical"}},[e("div",{staticClass:"card"},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{ref:"bomCode",attrs:{label:"BOM编号",prop:"bomCode"}},[e("a-input",{attrs:{placeholder:"请输入BOM编号，格式为BOM加4位数字",disabled:!!t.ndoEditParams.row},on:{change:t.inChange},model:{value:t.entity.bomCode,callback:function(e){t.$set(t.entity,"bomCode",e)},expression:"entity.bomCode"}})],1)],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{ref:"productId",attrs:{label:"产品",prop:"productId"}},[e("a-select",{attrs:{placeholder:"请选择产品",disabled:!!t.ndoEditParams.row},on:{change:t.handleProductChange},model:{value:t.entity.productId,callback:function(e){t.$set(t.entity,"productId",e)},expression:"entity.productId"}},t._l(t.productList,(function(a){return e("a-select-option",{key:a.id,attrs:{value:a.id}},[t._v(" "+t._s(a.productCode)+" - "+t._s(a.name)+" ")])})),1)],1)],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{ref:"version",attrs:{label:"BOM版本",prop:"version"}},[e("a-input",{attrs:{placeholder:"请输入BOM版本"},on:{change:t.inChange},model:{value:t.entity.version,callback:function(e){t.$set(t.entity,"version",e)},expression:"entity.version"}})],1)],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{ref:"effectiveDate",attrs:{label:"生效日期",prop:"effectiveDate"}},[e("a-date-picker",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择生效日期"},model:{value:t.entity.effectiveDate,callback:function(e){t.$set(t.entity,"effectiveDate",e)},expression:"entity.effectiveDate"}})],1)],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{ref:"status",attrs:{label:"状态",prop:"status"}},[e("a-radio-group",{model:{value:t.entity.status,callback:function(e){t.$set(t.entity,"status",e)},expression:"entity.status"}},[e("a-radio",{attrs:{value:"启用"}},[t._v("启用")]),e("a-radio",{attrs:{value:"停用"}},[t._v("停用")])],1)],1)],1),e("a-col",{attrs:{sm:18}},[e("a-form-model-item",{ref:"remark",attrs:{label:"备注",prop:"remark"}},[e("a-textarea",{attrs:{placeholder:"请输入备注信息",rows:2},model:{value:t.entity.remark,callback:function(e){t.$set(t.entity,"remark",e)},expression:"entity.remark"}})],1)],1)],1)],1),e("g-collapse",{attrs:{headerName:"物料清单"},scopedSlots:t._u([{key:"content",fn:function(){return[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{sm:24}},[e("a-button",{staticStyle:{"margin-bottom":"16px"},attrs:{type:"primary",icon:"plus"},on:{click:t.addMaterial}},[t._v(" 添加物料 ")])],1),e("a-col",{attrs:{sm:24}},[e("a-table",{attrs:{columns:t.materialColumns,dataSource:t.entity.materials,pagination:!1,size:"small",rowKey:"id"},scopedSlots:t._u([{key:"materialCode",fn:function(a,i,r){return[e("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择物料"},on:{change:e=>t.handleMaterialChange(e,r)},model:{value:t.entity.materials[r].materialId,callback:function(e){t.$set(t.entity.materials[r],"materialId",e)},expression:"entity.materials[index].materialId"}},t._l(t.materialList,(function(a){return e("a-select-option",{key:a.id,attrs:{value:a.id}},[t._v(" "+t._s(a.materialCode)+" - "+t._s(a.name)+" ")])})),1)]}},{key:"quantity",fn:function(a,i,r){return[e("a-input-number",{staticStyle:{width:"100%"},attrs:{min:1,precision:0},model:{value:t.entity.materials[r].quantity,callback:function(e){t.$set(t.entity.materials[r],"quantity",e)},expression:"entity.materials[index].quantity"}})]}},{key:"position",fn:function(a,i,r){return[e("a-input",{attrs:{placeholder:"请输入安装位置"},model:{value:t.entity.materials[r].position,callback:function(e){t.$set(t.entity.materials[r],"position",e)},expression:"entity.materials[index].position"}})]}},{key:"remark",fn:function(a,i,r){return[e("a-input",{attrs:{placeholder:"请输入备注"},model:{value:t.entity.materials[r].remark,callback:function(e){t.$set(t.entity.materials[r],"remark",e)},expression:"entity.materials[index].remark"}})]}},{key:"action",fn:function(a,i,r){return[e("a-button",{attrs:{type:"danger",icon:"delete",size:"small"},on:{click:()=>t.removeMaterial(r)}})]}}])})],1)],1)]},proxy:!0}])}),e("g-collapse",{attrs:{headerName:"详细信息"},scopedSlots:t._u([{key:"content",fn:function(){return[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{attrs:{label:"创建人"}},[e("span",[t._v(t._s(t.entity.createdBy||"未知"))])])],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{attrs:{label:"创建时间"}},[e("span",[t._v(t._s(t.entity.createdTime||"未知"))])])],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{attrs:{label:"修改人"}},[e("span",[t._v(t._s(t.entity.modifiedBy||"未知"))])])],1),e("a-col",{attrs:{sm:6}},[e("a-form-model-item",{attrs:{label:"修改时间"}},[e("span",[t._v(t._s(t.entity.modifiedTime||"未知"))])])],1)],1)]},proxy:!0}])})],1)],1)},r=[],s=a(36026),o={name:"CreateOrEditProductBom",mixins:[s.GE],data(){return{loading:!1,entity:{id:void 0,bomCode:"",productId:void 0,productCode:"",productName:"",version:"",effectiveDate:null,status:"启用",remark:"",materials:[],createdBy:"",createdTime:"",modifiedBy:"",modifiedTime:""},rules:{bomCode:[{required:!0,message:"请输入BOM编号",trigger:"change"},{pattern:/^BOM\d{4}$/,message:"BOM编号必须为BOM加4位数字",trigger:"change"}],productId:[{required:!0,message:"请选择产品",trigger:"change"}],version:[{required:!0,message:"请输入BOM版本",trigger:"change"}],effectiveDate:[{required:!0,message:"请选择生效日期",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},materialColumns:[{title:"物料",dataIndex:"materialCode",width:"30%",scopedSlots:{customRender:"materialCode"}},{title:"数量",dataIndex:"quantity",width:"15%",scopedSlots:{customRender:"quantity"}},{title:"安装位置",dataIndex:"position",width:"20%",scopedSlots:{customRender:"position"}},{title:"备注",dataIndex:"remark",width:"25%",scopedSlots:{customRender:"remark"}},{title:"操作",key:"action",width:"10%",scopedSlots:{customRender:"action"}}],productList:[],materialList:[]}},created(){this.fetchProductList(),this.fetchMaterialList()},methods:{init(){console.log(this.id,"初始化"),this.loading=!0,this.id?setTimeout((()=>{this.initFormData(),this.loading=!1}),500):(this.reset(),this.loading=!1)},resetFormData(){this.entity={id:void 0,bomCode:"",productId:void 0,productCode:"",productName:"",version:"",effectiveDate:null,status:"启用",remark:"",materials:[],createdBy:"",createdTime:"",modifiedBy:"",modifiedTime:""}},initFormData(){if(this.ndoEditParams.row){const t=this.ndoEditParams.row;this.entity={...this.entity,...t,materials:t.materials||[]}}},async save(){let t=await this.checkError();if(t){if(0===this.entity.materials.length)return void this.$message.error("请至少添加一个物料");const t=this.entity.materials.find((t=>!t.materialId||!t.quantity));if(t)return void this.$message.error("请完善物料信息");this.loading=!0,setTimeout((()=>{this.loading=!1,this.saveSuccess(this.entity.bomCode),this.handleSaveEndBackView(this.id),this.refreshParent({reset:null})}),500)}},inChange(t){console.log(t.target.value)},fetchProductList(){setTimeout((()=>{this.productList=Array.from({length:10},((t,e)=>({id:e+1,productCode:`P${String(e+1).padStart(4,"0")}`,name:`产品${e+1}`})))}),500)},fetchMaterialList(){setTimeout((()=>{this.materialList=Array.from({length:20},((t,e)=>({id:e+1,materialCode:`M${String(e+1).padStart(4,"0")}`,name:`物料${e+1}`})))}),500)},handleProductChange(t){const e=this.productList.find((e=>e.id===t));e&&(this.entity.productCode=e.productCode,this.entity.productName=e.name)},addMaterial(){this.entity.materials.push({id:Date.now(),materialId:void 0,materialCode:"",materialName:"",quantity:1,position:"",remark:""})},removeMaterial(t){this.entity.materials.splice(t,1)},handleMaterialChange(t,e){const a=this.materialList.find((e=>e.id===t));a&&(this.entity.materials[e].materialCode=a.materialCode,this.entity.materials[e].materialName=a.name)}}},n=o,l=a(1001),d=(0,l.Z)(n,i,r,!1,null,"1608436a",null),m=d.exports}}]);
//# sourceMappingURL=6251.689d0e4b.js.map