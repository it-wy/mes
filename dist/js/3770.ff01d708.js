"use strict";(self["webpackChunkdata_v2"]=self["webpackChunkdata_v2"]||[]).push([[3770,1184,8648],{51184:function(e,t,l){l.r(t),l.d(t,{default:function(){return d}});var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"poster-canvas",on:{dragover:function(e){e.preventDefault()},drop:e.handleDrop}},[t("div",{staticClass:"canvas-container"},[t("div",{staticClass:"canvas-grid"}),t("div",{staticClass:"canvas-size-controller"},[t("a-input-number",{attrs:{min:100,max:2e3},on:{change:e.handleCanvasSizeChange},model:{value:e.canvasWidth,callback:function(t){e.canvasWidth=t},expression:"canvasWidth"}}),t("span",{staticClass:"size-separator"},[e._v("×")]),t("a-input-number",{attrs:{min:100,max:2e3},on:{change:e.handleCanvasSizeChange},model:{value:e.canvasHeight,callback:function(t){e.canvasHeight=t},expression:"canvasHeight"}})],1),t("div",{staticClass:"canvas-content",style:{width:`${e.canvasWidth}px`,height:`${e.canvasHeight}px`}},e._l(e.value,(function(l){return t("div",{key:l.id,staticClass:"canvas-element",class:{"is-selected":e.selectedElement?.id===l.id},style:e.getElementStyle(l),on:{click:function(t){return t.stopPropagation(),e.handleSelect(l)},mousedown:function(t){return t.stopPropagation(),e.handleElementMouseDown(t,l)}}},["text"===l.type?[t("div",{staticClass:"text-content",style:e.getTextStyle(l)},[e._v(" "+e._s(l.content)+" ")])]:e._e(),"image"===l.type?[t("img",{style:e.getImageStyle(l),attrs:{src:l.url,draggable:"false"}})]:e._e(),"shape"===l.type?[t("div",{staticClass:"shape-content",style:e.getShapeStyle(l)})]:e._e(),"qrcode"===l.type?[t("div",{staticClass:"qrcode-content"},[t("qrcode",{attrs:{value:l.content,size:Math.min(l.style.width,l.style.height),level:"H",foreground:l.style.color||"#000000",background:l.style.backgroundColor||"#FFFFFF"}})],1)]:e._e(),e.selectedElement?.id===l.id?[e._l(e.controlPoints,(function(n,s){return t("div",{key:s,staticClass:"control-point",class:n.class,style:e.getControlPointStyle(n),on:{mousedown:function(t){return t.stopPropagation(),e.handleControlPointMouseDown(t,n,l)}}})})),t("div",{staticClass:"rotate-handle",on:{mousedown:function(t){return t.stopPropagation(),e.handleRotateStart(t,l)}}})]:e._e()],2)})),0)])])},s=[],a=l(69574),i={name:"PosterCanvas",components:{qrcode:a.Z},props:{value:{type:Array,default:()=>[]},selectedElement:{type:Object,default:null}},emits:["update:value","select","change"],data(){return{canvasWidth:750,canvasHeight:1334,isDragging:!1,startX:0,startY:0,originalPosition:null,originalSize:null,isResizing:!1,resizeType:"",isRotating:!1,rotateStartAngle:0,controlPoints:[{class:"nw",cursor:"nw-resize",x:0,y:0},{class:"n",cursor:"n-resize",x:.5,y:0},{class:"ne",cursor:"ne-resize",x:1,y:0},{class:"w",cursor:"w-resize",x:0,y:.5},{class:"e",cursor:"e-resize",x:1,y:.5},{class:"sw",cursor:"sw-resize",x:0,y:1},{class:"s",cursor:"s-resize",x:.5,y:1},{class:"se",cursor:"se-resize",x:1,y:1}]}},mounted(){document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp)},beforeUnmount(){document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp)},methods:{handleDrop(e){e.preventDefault();const t=e.dataTransfer.getData("componentType");if(!t)return;const l=e.currentTarget.getBoundingClientRect(),n=e.clientX-l.left,s=e.clientY-l.top;this.$emit("add",{type:t,style:{left:n,top:s}})},handleSelect(e){this.$emit("select",e)},handleElementMouseDown(e,t){e.target.closest(".control-point")||e.target.closest(".rotate-handle")||(e.stopPropagation(),this.isDragging=!0,this.startX=e.clientX,this.startY=e.clientY,this.originalPosition={left:t.style.left,top:t.style.top},this.handleSelect(t))},handleCanvasSizeChange(){this.$emit("change",this.value)},getElementStyle(e){return{position:"absolute",left:`${e.style.left}px`,top:`${e.style.top}px`,width:`${e.style.width}px`,height:`${e.style.height}px`,transform:`rotate(${e.style.rotate||0}deg)`,opacity:(e.style.opacity||100)/100,cursor:this.isDragging&&this.selectedElement?.id===e.id?"move":"pointer"}},getTextStyle(e){return{fontFamily:e.style.fontFamily||"Arial",fontSize:`${e.style.fontSize||14}px`,color:e.style.color||"#000000",textAlign:e.style.textAlign||"left",width:"100%",height:"100%",wordBreak:"break-word",overflow:"hidden"}},getImageStyle(e){return{width:"100%",height:"100%",objectFit:e.style.objectFit||"cover"}},getShapeStyle(e){return{width:"100%",height:"100%",backgroundColor:e.style.backgroundColor||"#000000",borderRadius:e.style.borderRadius||"0"}},getControlPointStyle(e){return{left:100*e.x+"%",top:100*e.y+"%",cursor:e.cursor}},handleControlPointMouseDown(e,t,l){e.stopPropagation(),this.isResizing=!0,this.resizeType=t.class,this.startX=e.clientX,this.startY=e.clientY,this.originalSize={width:l.style.width,height:l.style.height,left:l.style.left,top:l.style.top}},handleRotateStart(e,t){if(e.stopPropagation(),this.isRotating=!0,e.target.closest(".canvas-element")){const l=e.target.closest(".canvas-element").getBoundingClientRect(),n=l.left+l.width/2,s=l.top+l.height/2;this.rotateStartAngle=180*Math.atan2(e.clientY-s,e.clientX-n)/Math.PI-(t.style.rotate||0)}},handleMouseMove(e){this.selectedElement&&(this.isResizing?this.handleResize(e):this.isRotating?this.handleRotate(e):this.isDragging&&this.handleDrag(e))},handleMouseUp(){(this.isResizing||this.isRotating||this.isDragging)&&this.$emit("change",this.value),this.isResizing=!1,this.isRotating=!1,this.isDragging=!1},handleResize(e){const t=e.clientX-this.startX,l=e.clientY-this.startY,n=this.selectedElement,s={...n.style};switch(this.resizeType){case"nw":s.width=this.originalSize.width-t,s.height=this.originalSize.height-l,s.left=this.originalSize.left+t,s.top=this.originalSize.top+l;break;case"n":s.height=this.originalSize.height-l,s.top=this.originalSize.top+l;break;case"ne":s.width=this.originalSize.width+t,s.height=this.originalSize.height-l,s.top=this.originalSize.top+l;break;case"w":s.width=this.originalSize.width-t,s.left=this.originalSize.left+t;break;case"e":s.width=this.originalSize.width+t;break;case"sw":s.width=this.originalSize.width-t,s.height=this.originalSize.height+l,s.left=this.originalSize.left+t;break;case"s":s.height=this.originalSize.height+l;break;case"se":s.width=this.originalSize.width+t,s.height=this.originalSize.height+l;break}s.width=Math.max(10,s.width),s.height=Math.max(10,s.height),n.style=s,this.$emit("update:value",[...this.value])},handleRotate(e){const t=this.selectedElement;if(e.target.closest(".canvas-element")){const l=e.target.closest(".canvas-element").getBoundingClientRect(),n=l.left+l.width/2,s=l.top+l.height/2,a=180*Math.atan2(e.clientY-s,e.clientX-n)/Math.PI-this.rotateStartAngle;t.style.rotate=a,this.$emit("update:value",[...this.value])}},handleDrag(e){const t=e.clientX-this.startX,l=e.clientY-this.startY,n=this.selectedElement;n.style.left=this.originalPosition.left+t,n.style.top=this.originalPosition.top+l,this.$emit("update:value",[...this.value])}}},o=i,r=l(1001),c=(0,r.Z)(o,n,s,!1,null,"0270f42a",null),d=c.exports},99718:function(e,t,l){l.r(t),l.d(t,{default:function(){return p}});var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"poster-design"},[t("div",{staticClass:"poster-design-header"},[t("a-space",[t("a-button",{attrs:{type:"primary"},on:{click:e.handleSave},scopedSlots:e._u([{key:"icon",fn:function(){return[t("save-outlined")]},proxy:!0}])},[e._v(" 保存 ")]),t("a-button",{on:{click:e.handlePreview},scopedSlots:e._u([{key:"icon",fn:function(){return[t("eye-outlined")]},proxy:!0}])},[e._v(" 预览 ")]),t("a-button",{on:{click:e.handleClear},scopedSlots:e._u([{key:"icon",fn:function(){return[t("delete-outlined")]},proxy:!0}])},[e._v(" 清空 ")]),t("a-button",{attrs:{disabled:!e.canUndo},on:{click:e.handleUndo},scopedSlots:e._u([{key:"icon",fn:function(){return[t("undo-outlined")]},proxy:!0}])},[e._v(" 撤销 ")]),t("a-button",{attrs:{disabled:!e.canRedo},on:{click:e.handleRedo},scopedSlots:e._u([{key:"icon",fn:function(){return[t("redo-outlined")]},proxy:!0}])},[e._v(" 重做 ")]),t("a-dropdown",{scopedSlots:e._u([{key:"overlay",fn:function(){return[t("a-menu",[t("a-menu-item",{key:"1",on:{click:e.handleExport}},[t("download-outlined"),e._v("导出配置 ")],1),t("a-menu-item",{key:"2",on:{click:e.handleImportClick}},[t("upload-outlined"),e._v("导入配置 ")],1)],1)]},proxy:!0}])},[t("a-button",[e._v(" 更多操作 "),t("down-outlined")],1)],1),t("input",{ref:"fileInput",staticStyle:{display:"none"},attrs:{type:"file",accept:".json"},on:{change:e.handleImportFile}})],1)],1),t("div",{staticClass:"poster-design-content"},[t("div",{staticClass:"component-panel"},[t("h3",[e._v("基础组件")]),t("div",{staticClass:"component-list"},e._l(e.basicComponents,(function(l){return t("div",{key:l.type,staticClass:"component-item",attrs:{draggable:""},on:{dragstart:function(t){return e.handleComponentDragStart(l)},click:function(t){return e.handleAddComponent(l)}}},[t(l.icon,{tag:"component"}),t("span",[e._v(e._s(l.label))])],1)})),0),t("h3",{staticClass:"mt-4"},[e._v("模板")]),t("div",{staticClass:"template-list"},e._l(e.templates,(function(l){return t("div",{key:l.id,staticClass:"template-item",on:{click:function(t){return e.handleApplyTemplate(l)}}},[t("img",{attrs:{src:l.thumbnail,alt:l.name}}),t("span",[e._v(e._s(l.name))])])})),0)]),t("poster-canvas",{ref:"canvas",attrs:{"selected-element":e.selectedElement},on:{select:e.handleSelectElement,change:e.handleCanvasChange},model:{value:e.elements,callback:function(t){e.elements=t},expression:"elements"}}),e.selectedElement?t("div",{staticClass:"property-panel"},[t("h3",[e._v("属性设置")]),t("a-form",{attrs:{layout:"vertical"}},[t("a-form-item",{attrs:{label:"位置"}},[t("a-row",{attrs:{gutter:8}},[t("a-col",{attrs:{span:12}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{placeholder:"X"},on:{change:e.handleStyleChange},model:{value:e.selectedElement.style.left,callback:function(t){e.$set(e.selectedElement.style,"left",t)},expression:"selectedElement.style.left"}})],1),t("a-col",{attrs:{span:12}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{placeholder:"Y"},on:{change:e.handleStyleChange},model:{value:e.selectedElement.style.top,callback:function(t){e.$set(e.selectedElement.style,"top",t)},expression:"selectedElement.style.top"}})],1)],1)],1),t("a-form-item",{attrs:{label:"尺寸"}},[t("a-row",{attrs:{gutter:8}},[t("a-col",{attrs:{span:12}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{placeholder:"宽"},on:{change:e.handleStyleChange},model:{value:e.selectedElement.style.width,callback:function(t){e.$set(e.selectedElement.style,"width",t)},expression:"selectedElement.style.width"}})],1),t("a-col",{attrs:{span:12}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{placeholder:"高"},on:{change:e.handleStyleChange},model:{value:e.selectedElement.style.height,callback:function(t){e.$set(e.selectedElement.style,"height",t)},expression:"selectedElement.style.height"}})],1)],1)],1),t("a-form-item",{attrs:{label:"旋转"}},[t("a-slider",{attrs:{min:0,max:360},on:{change:e.handleStyleChange},model:{value:e.selectedElement.style.rotate,callback:function(t){e.$set(e.selectedElement.style,"rotate",t)},expression:"selectedElement.style.rotate"}})],1),t("a-form-item",{attrs:{label:"透明度"}},[t("a-slider",{attrs:{min:0,max:100,step:1},on:{change:e.handleStyleChange},model:{value:e.selectedElement.style.opacity,callback:function(t){e.$set(e.selectedElement.style,"opacity",t)},expression:"selectedElement.style.opacity"}})],1),"text"===e.selectedElement.type?[t("a-form-item",{attrs:{label:"文本内容"}},[t("a-textarea",{attrs:{rows:3},on:{change:e.handleContentChange},model:{value:e.selectedElement.content,callback:function(t){e.$set(e.selectedElement,"content",t)},expression:"selectedElement.content"}})],1),t("a-form-item",{attrs:{label:"字体"}},[t("a-select",{staticStyle:{width:"100%"},on:{change:e.handleStyleChange},model:{value:e.selectedElement.style.fontFamily,callback:function(t){e.$set(e.selectedElement.style,"fontFamily",t)},expression:"selectedElement.style.fontFamily"}},[t("a-select-option",{attrs:{value:"Arial"}},[e._v("Arial")]),t("a-select-option",{attrs:{value:"Times New Roman"}},[e._v("Times New Roman")]),t("a-select-option",{attrs:{value:"Microsoft YaHei"}},[e._v("微软雅黑")])],1)],1),t("a-form-item",{attrs:{label:"字号"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:12,max:72},on:{change:e.handleStyleChange},model:{value:e.selectedElement.style.fontSize,callback:function(t){e.$set(e.selectedElement.style,"fontSize",t)},expression:"selectedElement.style.fontSize"}})],1),t("a-form-item",{attrs:{label:"颜色"}},[t("a-input",{staticStyle:{width:"100%"},attrs:{type:"color"},on:{change:e.handleStyleChange},model:{value:e.selectedElement.style.color,callback:function(t){e.$set(e.selectedElement.style,"color",t)},expression:"selectedElement.style.color"}})],1),t("a-form-item",{attrs:{label:"对齐方式"}},[t("a-radio-group",{on:{change:e.handleStyleChange},model:{value:e.selectedElement.style.textAlign,callback:function(t){e.$set(e.selectedElement.style,"textAlign",t)},expression:"selectedElement.style.textAlign"}},[t("a-radio-button",{attrs:{value:"left"}},[e._v("左对齐")]),t("a-radio-button",{attrs:{value:"center"}},[e._v("居中")]),t("a-radio-button",{attrs:{value:"right"}},[e._v("右对齐")])],1)],1)]:e._e(),"image"===e.selectedElement.type?[t("a-form-item",{attrs:{label:"图片"}},[t("div",{staticClass:"image-upload"},[e.selectedElement.url?t("img",{staticClass:"preview-image",attrs:{src:e.selectedElement.url}}):e._e(),t("a-upload",{attrs:{"show-upload-list":!1,"before-upload":e.handleImageUpload}},[t("a-button",[e._v("更换图片")])],1)],1)])]:e._e(),"qrcode"===e.selectedElement.type?[t("a-form-item",{attrs:{label:"二维码内容"}},[t("a-textarea",{attrs:{rows:3,placeholder:"请输入二维码内容，如网址等"},on:{change:e.handleContentChange},model:{value:e.selectedElement.content,callback:function(t){e.$set(e.selectedElement,"content",t)},expression:"selectedElement.content"}})],1),t("a-form-item",{attrs:{label:"前景色"}},[t("a-input",{staticStyle:{width:"100%"},attrs:{type:"color"},on:{change:e.handleStyleChange},model:{value:e.selectedElement.style.color,callback:function(t){e.$set(e.selectedElement.style,"color",t)},expression:"selectedElement.style.color"}})],1),t("a-form-item",{attrs:{label:"背景色"}},[t("a-input",{staticStyle:{width:"100%"},attrs:{type:"color"},on:{change:e.handleStyleChange},model:{value:e.selectedElement.style.backgroundColor,callback:function(t){e.$set(e.selectedElement.style,"backgroundColor",t)},expression:"selectedElement.style.backgroundColor"}})],1)]:e._e()],2)],1):e._e()],1),t("poster-preview",{attrs:{visible:e.previewVisible,elements:e.elements},on:{"update:visible":function(t){e.previewVisible=t}}})],1)},s=[],a=l(58430);const i=[{type:"text",label:"文本",defaultStyle:{left:0,top:0,width:200,height:40,rotate:0,opacity:100,fontSize:14,fontFamily:"Arial",color:"#000000",textAlign:"left"},defaultContent:"请输入文本"},{type:"image",label:"图片",defaultStyle:{left:0,top:0,width:200,height:200,rotate:0,opacity:100,objectFit:"cover"},defaultUrl:""},{type:"shape",label:"形状",defaultStyle:{left:0,top:0,width:100,height:100,rotate:0,opacity:100,backgroundColor:"#000000",borderRadius:"0"}},{type:"qrcode",label:"二维码",icon:a.QrcodeOutlined,defaultStyle:{left:0,top:0,width:200,height:200,rotate:0,opacity:100,color:"#000000",backgroundColor:"#FFFFFF"},defaultContent:"https://example.com"}],o=[{id:"template-1",name:"商品海报",thumbnail:"https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=400&auto=format",elements:[{id:"template-1-1",type:"image",style:{left:0,top:0,width:750,height:750,rotate:0,opacity:100,objectFit:"cover"},url:"https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=800&auto=format"},{id:"template-1-2",type:"text",style:{left:20,top:770,width:710,height:60,rotate:0,opacity:100,fontSize:24,fontFamily:"Microsoft YaHei",color:"#333333",textAlign:"left"},content:"商品标题"},{id:"template-1-3",type:"text",style:{left:20,top:840,width:710,height:40,rotate:0,opacity:100,fontSize:32,fontFamily:"Arial",color:"#ff4400",textAlign:"left"},content:"¥ 99.00"},{id:"template-1-4",type:"qrcode",style:{left:550,top:900,width:180,height:180,rotate:0,opacity:100,color:"#000000",backgroundColor:"#FFFFFF"},content:"https://example.com/product/1"}]},{id:"template-2",name:"活动海报",thumbnail:"https://images.unsplash.com/photo-1492684223066-81342ee5ff30?w=400&auto=format",elements:[{id:"template-2-1",type:"image",style:{left:0,top:0,width:750,height:1e3,rotate:0,opacity:100,objectFit:"cover"},url:"https://images.unsplash.com/photo-1505373877841-8d25f7d46678?w=800&auto=format"},{id:"template-2-2",type:"text",style:{left:50,top:1020,width:650,height:80,rotate:0,opacity:100,fontSize:28,fontFamily:"Microsoft YaHei",color:"#333333",textAlign:"center"},content:"活动标题"},{id:"template-2-3",type:"text",style:{left:50,top:1110,width:650,height:40,rotate:0,opacity:100,fontSize:20,fontFamily:"Microsoft YaHei",color:"#666666",textAlign:"center"},content:"活动时间：2024-01-01 至 2024-12-31"},{id:"template-2-4",type:"qrcode",style:{left:285,top:1160,width:180,height:180,rotate:0,opacity:100,color:"#000000",backgroundColor:"#FFFFFF"},content:"https://example.com/event/1"}]}];var r=l(51184),c=l(21685),d={name:"PosterDesign",components:{SaveOutlined:a.SaveOutlined,EyeOutlined:a.EyeOutlined,DeleteOutlined:a.DeleteOutlined,UndoOutlined:a.UndoOutlined,RedoOutlined:a.RedoOutlined,DownOutlined:a.DownOutlined,UploadOutlined:a.UploadOutlined,DownloadOutlined:a.DownloadOutlined,PosterCanvas:r["default"],PosterPreview:c["default"]},data(){return{basicComponents:i,templates:o,elements:[],selectedElement:null,dragComponent:null,history:[],historyIndex:-1,maxHistory:20,previewVisible:!1}},computed:{canUndo(){return this.historyIndex>0},canRedo(){return this.historyIndex<this.history.length-1}},methods:{handleComponentDragStart(e){this.dragComponent=e,event.dataTransfer.setData("componentType",e.type)},handleAddComponent(e){const t={id:`element-${Date.now()}`,type:e.type,style:{...e.defaultStyle},content:e.defaultContent||"",url:e.defaultUrl||""},l=[...this.elements,t];this.saveHistory(l),this.elements=l,this.selectedElement=t},handleSelectElement(e){this.selectedElement=e},handleCanvasChange(e){this.saveHistory(e),this.elements=e},handleStyleChange(){this.saveHistory(this.elements)},handleContentChange(){this.saveHistory(this.elements)},async handleImageUpload(e){if(0!==e.type.indexOf("image/"))return this.$message.error("请上传图片文件"),!1;const t=new FileReader;return t.onload=e=>{this.selectedElement.url=e.target.result,this.saveHistory(this.elements)},t.readAsDataURL(e),!1},handleSave(){console.log("保存的海报数据：",this.elements)},handlePreview(){this.previewVisible=!0},handleClear(){this.$confirm({title:"确认清空",content:"是否确认清空当前设计？此操作不可恢复。",onOk:()=>{const e=[];this.saveHistory(e),this.elements=e,this.selectedElement=null}})},handleUndo(){this.canUndo&&(this.historyIndex--,this.elements=JSON.parse(this.history[this.historyIndex]),this.selectedElement=null)},handleRedo(){this.canRedo&&(this.historyIndex++,this.elements=JSON.parse(this.history[this.historyIndex]),this.selectedElement=null)},handleExport(){const e={version:"1.0.0",elements:this.elements},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),l=URL.createObjectURL(t),n=document.createElement("a");n.href=l,n.download=`poster-config-${Date.now()}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(l)},handleImportClick(){this.$refs.fileInput.click()},handleImportFile(e){const t=e.target.files[0];if(!t)return;const l=new FileReader;l.onload=e=>{try{const t=JSON.parse(e.target.result);if(!t.elements||!Array.isArray(t.elements))throw new Error("Invalid config format");this.elements=t.elements.map((e=>({...e,id:`element-${Date.now()}-${Math.random()}`}))),this.$message.success("配置导入成功")}catch(t){this.$message.error("配置文件格式错误")}},l.readAsText(t)},handleApplyTemplate(e){this.$confirm({title:"应用模板",content:"应用模板将清空当前设计，是否继续？",onOk:()=>{const t=e.elements.map((e=>({...e,id:`element-${Date.now()}-${Math.random()}`})));this.saveHistory(t),this.elements=t,this.selectedElement=null}})},saveHistory(e){const t=JSON.stringify(e),l=this.history[this.historyIndex];t!==l&&(this.historyIndex++,this.history.splice(this.historyIndex),this.history.push(t),this.history.length>this.maxHistory&&(this.history.shift(),this.historyIndex--))}}},h=d,m=l(1001),u=(0,m.Z)(h,n,s,!1,null,"2c5d2838",null),p=u.exports}}]);
//# sourceMappingURL=3770.ff01d708.js.map