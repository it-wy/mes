"use strict";(self["webpackChunkdata_v2"]=self["webpackChunkdata_v2"]||[]).push([[8333],{78333:function(e,a,t){t.r(a),t.d(a,{default:function(){return i}});var r=function(){var e=this,a=e._self._c;return a("a-modal",{attrs:{title:"表单预览",visible:e.visible,width:720,footer:null},on:{cancel:e.handleCancel}},[a("a-form",{ref:"previewForm",attrs:{model:e.formData,"label-col":{span:6},"wrapper-col":{span:16}}},[e._l(e.formItems,(function(t){return[a("a-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.props.hidden,expression:"!item.props.hidden"}],key:t.id,attrs:{label:t.props.label,name:t.props.name,rules:e.transformRules(t.props.rules)}},["a-input"===t.type?a("a-input",e._b({on:{change:a=>e.handleFieldChange(t.props.name,a.target.value),focus:a=>e.handleFieldEvent(t,"focus",a.target.value),blur:a=>e.handleFieldEvent(t,"blur",a.target.value)},model:{value:e.formData[t.props.name],callback:function(a){e.$set(e.formData,t.props.name,a)},expression:"formData[item.props.name]"}},"a-input",e.getComponentProps(t),!1)):"a-textarea"===t.type?a("a-textarea",e._b({on:{change:a=>e.handleFieldChange(t.props.name,a.target.value),focus:a=>e.handleFieldEvent(t,"focus",a.target.value),blur:a=>e.handleFieldEvent(t,"blur",a.target.value)},model:{value:e.formData[t.props.name],callback:function(a){e.$set(e.formData,t.props.name,a)},expression:"formData[item.props.name]"}},"a-textarea",e.getComponentProps(t),!1)):"a-input-number"===t.type?a("a-input-number",e._b({staticStyle:{width:"100%"},on:{change:a=>e.handleFieldChange(t.props.name,a),focus:()=>e.handleFieldEvent(t,"focus",e.formData[t.props.name]),blur:()=>e.handleFieldEvent(t,"blur",e.formData[t.props.name])},model:{value:e.formData[t.props.name],callback:function(a){e.$set(e.formData,t.props.name,a)},expression:"formData[item.props.name]"}},"a-input-number",e.getComponentProps(t),!1)):"a-select"===t.type?a("a-select",e._b({staticStyle:{width:"100%"},on:{change:a=>e.handleFieldChange(t.props.name,a),focus:()=>e.handleFieldEvent(t,"focus",e.formData[t.props.name]),blur:()=>e.handleFieldEvent(t,"blur",e.formData[t.props.name])},model:{value:e.formData[t.props.name],callback:function(a){e.$set(e.formData,t.props.name,a)},expression:"formData[item.props.name]"}},"a-select",e.getComponentProps(t),!1),e._l(t.props.options,(function(t){return a("a-select-option",{key:t.value,attrs:{value:t.value}},[e._v(" "+e._s(t.label)+" ")])})),1):"a-date-picker"===t.type?a("a-date-picker",e._b({staticStyle:{width:"100%"},on:{change:a=>e.handleFieldChange(t.props.name,a),focus:()=>e.handleFieldEvent(t,"focus",e.formData[t.props.name]),blur:()=>e.handleFieldEvent(t,"blur",e.formData[t.props.name])},model:{value:e.formData[t.props.name],callback:function(a){e.$set(e.formData,t.props.name,a)},expression:"formData[item.props.name]"}},"a-date-picker",e.getComponentProps(t),!1)):"a-switch"===t.type?a("a-switch",e._b({on:{change:a=>e.handleFieldChange(t.props.name,a)},model:{value:e.formData[t.props.name],callback:function(a){e.$set(e.formData,t.props.name,a)},expression:"formData[item.props.name]"}},"a-switch",e.getComponentProps(t),!1)):"a-radio-group"===t.type?a("a-radio-group",e._b({on:{change:a=>e.handleFieldChange(t.props.name,a.target.value)},model:{value:e.formData[t.props.name],callback:function(a){e.$set(e.formData,t.props.name,a)},expression:"formData[item.props.name]"}},"a-radio-group",e.getComponentProps(t),!1),e._l(t.props.options,(function(t){return a("a-radio",{key:t.value,attrs:{value:t.value}},[e._v(" "+e._s(t.label)+" ")])})),1):"a-checkbox-group"===t.type?a("a-checkbox-group",e._b({on:{change:a=>e.handleFieldChange(t.props.name,a)},model:{value:e.formData[t.props.name],callback:function(a){e.$set(e.formData,t.props.name,a)},expression:"formData[item.props.name]"}},"a-checkbox-group",e.getComponentProps(t),!1),e._l(t.props.options,(function(t){return a("a-checkbox",{key:t.value,attrs:{value:t.value}},[e._v(" "+e._s(t.label)+" ")])})),1):e._e()],1)]})),a("div",{staticClass:"form-actions"},[a("a-space",[a("a-button",{on:{click:e.handleReset}},[e._v("重置")]),a("a-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("提交")])],1)],1)],2)],1)},o=[],n={name:"FormPreview",props:{visible:{type:Boolean,default:!1},formItems:{type:Array,default:()=>[]}},data(){return{formData:{}}},watch:{visible(e){e&&this.initFormData()}},methods:{initFormData(){const e={};this.formItems.forEach((a=>{if(a.props.name)switch(a.type){case"a-switch":e[a.props.name]=!1;break;case"a-checkbox-group":e[a.props.name]=[];break;case"a-input-number":e[a.props.name]=null;break;default:e[a.props.name]=""}})),this.formData=e},transformRules(e){return e?e.map((e=>{const a={...e};return"required"===e.type&&(a.required=!0,delete a.type),a})):[]},getComponentProps(e){const a={...e.props};return delete a.label,delete a.name,delete a.rules,a},handleSubmit(){this.$refs.previewForm.validate().then((()=>{this.$message.success("表单验证通过"),console.log("表单数据：",this.formData)})).catch((e=>{console.log("表单验证失败：",e)}))},handleReset(){this.$refs.previewForm.resetFields()},handleCancel(){this.$emit("update:visible",!1)},handleFieldEvent(e,a,t){e.props.linkage&&e.props.linkage.trigger===a&&this.handleLinkage(e,t)},handleFieldChange(e,a){this.formData[e]=a,this.formItems.forEach((t=>{t.props.name===e&&t.props.linkage&&"change"===t.props.linkage.trigger&&this.handleLinkage(t,a)}))},handleLinkage(e,a){const{trigger:t,actions:r}=e.props.linkage;r&&r.length&&r.forEach((e=>{const t=this.formItems.find((a=>a.props.name===e.targetField));if(!t)return;let r=!0;if(e.condition)try{const t=new Function("value",`return ${e.condition}`);r=t(a)}catch(o){return void console.error("联动条件执行错误:",o)}if(console.log("action",e,r),r)switch(e.type){case"show":t.props.hidden=!1;break;case"hide":t.props.hidden=!0;break;case"required":this.updateValidationRules(t,!0);break;case"disabled":t.props.disabled=!0;break;case"setValue":this.formData[t.props.name]=e.value;break}else switch(e.type){case"show":t.props.hidden=!0;break;case"hide":t.props.hidden=!1;break;case"required":this.updateValidationRules(t,!1);break;case"disabled":t.props.disabled=!1;break;case"setValue":this.formData[t.props.name]="";break}}))},updateValidationRules(e,a){const t=e.props.rules||[],r=t.find((e=>"required"===e.type));if(a&&!r)t.push({type:"required",message:"该字段为必填项"});else if(!a&&r){const e=t.indexOf(r);t.splice(e,1)}e.props.rules=t}}},s=n,p=t(1001),l=(0,p.Z)(s,r,o,!1,null,"6db1d980",null),i=l.exports}}]);
//# sourceMappingURL=8333.2e0af839.js.map