"use strict";(self["webpackChunkdata_v2"]=self["webpackChunkdata_v2"]||[]).push([[2630],{42570:function(t,e,a){a.d(e,{Z:function(){return d}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"modal"},[e("div",{staticClass:"modal-content"},[e("div",{staticClass:"sign-container"},[e("h3",{staticClass:"sign-title"},[t._v(t._s(t.title||"请在下方区域签名"))]),e("g-sign",{ref:"signBoard",attrs:{"line-width":t.lineWidth,"line-color":t.lineColor,"background-color":t.backgroundColor,"save-format":t.saveFormat},on:{save:t.handleSave,clear:t.handleClear,"save-error":t.handleError}})],1)]),e("div",{staticClass:"modal-footer"},[e("g-btn",{attrs:{text:"确认",type:"primary"},on:{callback:t.save}}),e("g-btn",{attrs:{text:"取消"},on:{callback:function(e){return t.$emit("closeModal")}}})],1)])},n=[],i=a(60704),o={name:"GSignModal",components:{GSign:i.Z},props:{title:{type:String,default:""},lineWidth:{type:Number,default:2},lineColor:{type:String,default:"#000000"},backgroundColor:{type:String,default:"#ffffff"},saveFormat:{type:String,default:"png",validator:t=>["png","jpeg","webp"].includes(t)}},data(){return{signatureData:null,hasSignature:!1}},methods:{handleSave(t){this.signatureData=t,this.hasSignature=!0},handleClear(){this.signatureData=null,this.hasSignature=!1},handleError(t){this.$message.error(t)},save(){this.hasSignature?(this.$emit("success",this.signatureData),this.$emit("closeModal")):this.$message.error("请先进行签名")},clearSignature(){this.$refs.signBoard&&this.$refs.signBoard.clearCanvas()}}},r=o,l=a(1001),c=(0,l.Z)(r,s,n,!1,null,"b8f67d68",null),d=c.exports},12630:function(t,e,a){a.r(e),a.d(e,{default:function(){return p}});var s=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("a-form-model",{ref:"form",staticClass:"h-father sflex",attrs:{model:t.entity,layout:"vertical",autocomplete:"off",rules:t.rules}},[e("g-body-form-layout",{scopedSlots:t._u([{key:"search-card",fn:function(){return[e("div",{staticClass:"search-card"},[e("g-container-list",{attrs:{value:t.entity.containerName},on:{"update:value":function(e){return t.$set(t.entity,"containerName",e)},searchClick:t.onSearch}})],1)]},proxy:!0},{key:"expand-card",fn:function(){return[e("div",{staticClass:"expand-card"},[e("g-collapse",{attrs:{headerName:"扩展信息"},scopedSlots:t._u([{key:"content",fn:function(){return[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{span:4}},[e("a-form-model-item",{attrs:{label:"设备"}},[e("g-select",{attrs:{showSearch:!0,loadType:"scroll"},on:{change:t.resourceChange},model:{value:t.entity.resourceId,callback:function(e){t.$set(t.entity,"resourceId",e)},expression:"entity.resourceId"}})],1)],1)],1)]},proxy:!0}])})],1)]},proxy:!0},{key:"card-body",fn:function(){return[e("g-collapse",{attrs:{headerName:"拆分信息"},scopedSlots:t._u([{key:"content",fn:function(){return[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{span:24}},[e("a-button",{attrs:{type:"primary"},on:{click:t.addDetailRow}},[t._v("添加批次")]),e("a-table",{staticClass:"mt-4",attrs:{dataSource:t.detailList,columns:t.columns,pagination:!1},scopedSlots:t._u([{key:"containerName",fn:function(a,s){return e("span",{},[e("a-form-model-item",{attrs:{rules:[{required:!0,message:"请输入批次名称"}]}},[e("a-input",{attrs:{placeholder:"请输入批次名称"},model:{value:s.containerName,callback:function(e){t.$set(s,"containerName",e)},expression:"record.containerName"}})],1)],1)}},{key:"splitQty",fn:function(a,s){return e("span",{},[e("a-form-model-item",{attrs:{rules:[{required:!0,message:"请输入拆分数量"}]}},[e("a-input-number",{staticStyle:{width:"100%"},attrs:{min:1e-4,max:s.maxQty,precision:4},on:{change:t.onMaxQtyChange},model:{value:s.splitQty,callback:function(e){t.$set(s,"splitQty",e)},expression:"record.splitQty"}})],1)],1)}},{key:"action",fn:function(a,s){return e("span",{},[e("a-space",[e("a-popconfirm",{attrs:{title:"确认删除?"},on:{confirm:function(e){return t.deleteDetailRow(s,t.index)}}},[e("a",[t._v("删除")])])],1)],1)}}])})],1)],1),e("a-row",{staticClass:"mt-4",attrs:{gutter:24}},[e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{label:"拆分原因",prop:"splitReasonId",rules:[{required:!0,message:"请选择拆分原因"}]}},[e("g-select",{model:{value:t.entity.splitReasonId,callback:function(e){t.$set(t.entity,"splitReasonId",e)},expression:"entity.splitReasonId"}})],1)],1),e("a-col",{attrs:{span:8}},[e("a-form-model-item",{attrs:{label:" "}},[e("a-checkbox",{model:{value:t.entity.isClose,callback:function(e){t.$set(t.entity,"isClose",e)},expression:"entity.isClose"}},[t._v("数量为0时关闭批次")])],1)],1)],1)]},proxy:!0}])}),t.dataPoints.length?e("g-collapse",{attrs:{headerName:"数据采集"},scopedSlots:t._u([{key:"content",fn:function(){return[e("g-data-points",{attrs:{dataPoints:t.dataPoints,validDataName:"dataPoints"}})]},proxy:!0}],null,!1,1867507197)}):t._e(),t.ppcDataPoints.length?e("g-collapse",{attrs:{headerName:"工艺参数"},scopedSlots:t._u([{key:"content",fn:function(){return[e("g-data-points",{attrs:{dataPoints:t.ppcDataPoints,validDataName:"ppcDataPoints"}})]},proxy:!0}],null,!1,4096235805)}):t._e(),e("g-collapse",{attrs:{headerName:"操作描述"},scopedSlots:t._u([{key:"content",fn:function(){return[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{span:12}},[e("a-form-model-item",{attrs:{label:"描述"}},[e("a-textarea",{attrs:{rows:4,maxLength:1e3,placeholder:"请输入操作描述"},model:{value:t.description,callback:function(e){t.description=e},expression:"description"}})],1)],1)],1)]},proxy:!0}])})]},proxy:!0},{key:"g-fixed-row",fn:function(){return[e("div",{staticClass:"g-fixed-row"},[e("g-btn",{attrs:{size:"large",text:"刷新"},on:{callback:t.refresh}}),e("g-btn",{attrs:{size:"large",text:"提交",type:"primary"},on:{callback:t.save}})],1)]},proxy:!0}])})],1)},n=[],i=a(20144),o=a(42570),r=a(36026),l=(0,i.aZ)({name:"DataV2SplitQty",data(){return{entity:{containerName:"",resourceId:"",splitReasonId:"",isClose:!1,dataPoints:[],ppcDataPoints:[]},description:"",dataPoints:[],ppcDataPoints:[],detailList:[],containerInfo:{},maxQty:0,columns:[{title:"批次名称",dataIndex:"containerName",key:"containerName",scopedSlots:{customRender:"containerName"}},{title:"拆分数量",dataIndex:"splitQty",key:"splitQty",scopedSlots:{customRender:"splitQty"}},{title:"操作",key:"action",scopedSlots:{customRender:"action"}}],rules:{splitReasonId:[{required:!0,message:"请选择拆分原因"}]}}},methods:{onSearch(t){t&&(this.loadContainerInfo(t),this.containerInfo=t,this.maxQty=t.qty||0,this.entity.containerName=t.containerName,this.dataPoints=t.dataPoints||[],this.ppcDataPoints=t.ppcDataPoints||[])},addDetailRow(){this.detailList.push({containerName:"",splitQty:null,maxQty:this.maxQty}),this.onMaxQtyChange()},deleteDetailRow(t,e){this.detailList.splice(e,1),this.onMaxQtyChange()},resourceChange(t){t&&this.loadProcessParameters(t)},onMaxQtyChange(){if(1===this.detailList.length)return void(this.detailList[0].maxQty=this.maxQty);let t=0;this.detailList.forEach((e=>{t+=Number(e.splitQty||0)})),this.detailList.forEach((e=>{e.maxQty=this.maxQty-(t-Number(e.splitQty||0))}))},save(){this.$refs.form.validate().then((t=>{if(t){let t=0;if(this.detailList.forEach((e=>{t+=Number(e.splitQty||0)})),t>this.maxQty)return void this.$message.error("拆分数量总和不能超过原批次数量");(0,r.f7)({title:"签名确认",width:"600px"},{component:o.Z,success:()=>{this.submitSplit()}})}}))},submitSplit(){const t={containerName:this.entity.containerName,resourceId:this.entity.resourceId,splitReasonId:this.entity.splitReasonId,isClose:this.entity.isClose,dataPoints:this.entity.dataPoints,ppcDataPoints:this.entity.ppcDataPoints,description:this.description,detailList:this.detailList};console.log("提交拆分数据:",t),this.$message.success("批次拆分成功"),this.refresh()},refresh(){this.entity={containerName:"",resourceId:"",splitReasonId:"",isClose:!1,dataPoints:[],ppcDataPoints:[]},this.description="",this.dataPoints=[],this.ppcDataPoints=[],this.detailList=[],this.containerInfo={},this.maxQty=0},loadContainerInfo(t){console.log("加载批次信息:",t)},loadProcessParameters(t){console.log("加载工艺参数:",t)}}}),c=l,d=a(1001),u=(0,d.Z)(c,s,n,!1,null,"4ae4dd08",null),p=u.exports}}]);
//# sourceMappingURL=2630.99941ca2.js.map