{"version":3,"file":"js/5763.d6ba81e6.js","mappings":"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","sources":["webpack://data-v2/./src/views/setting/formula-editor/formula-editor.vue?ed89","webpack://data-v2/src/views/setting/formula-editor/formula-editor.vue","webpack://data-v2/./src/views/setting/formula-editor/formula-editor.vue?851e","webpack://data-v2/./src/views/setting/formula-editor/formula-editor.vue"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{attrs:{\"id\":\"formulaPage\"}},[_c('div',{ref:\"formulaView\",staticClass:\"formulaView\",attrs:{\"id\":\"formulaView\"},on:{\"click\":function($event){$event.stopPropagation();return _vm.recordPosition()}}},_vm._l((_vm.formulaList),function(item,index){return _c('div',{key:index,staticClass:\"content-item\",on:{\"click\":function($event){$event.stopPropagation();return _vm.recordPosition(index)}}},[(item.type == 'num')?_c('div',{staticClass:\"num\"},[_vm._v(\" ‍\"+_vm._s(item.value)+\" \")]):(item.type == 'plain')?_c('div',{staticClass:\"plain\"},[_vm._v(\" ‍\"+_vm._s(item.value)+\" \")]):(item.type == 'obj')?_c('div',{staticClass:\"obj\"},[_vm._v(\" ‍\"+_vm._s(item.value)+\" \")]):_vm._e(),(item.cursor)?_c('div',{staticClass:\"cursor\"}):_vm._e()])}),0),_c('div',{staticClass:\"formula-controls mt_10\"},[_c('div',{staticClass:\"operator-group\"},_vm._l((_vm.operatorList),function(item){return _c('a-button',{key:item.id,staticClass:\"operator-btn\",on:{\"click\":function($event){return _vm.addItem(item.id, 'plain')}}},[_vm._v(\" \"+_vm._s(item.name)+\" \")])}),1),_c('div',{staticClass:\"data-tags\"},[_c('div',{staticClass:\"tag-group\"},_vm._l((_vm.dataList),function(item){return _c('a-tag',{key:item.id,staticClass:\"data-tag\",on:{\"click\":function($event){return _vm.addItem(item.id, 'obj')}}},[_vm._v(\" \"+_vm._s(item.name)+\" \")])}),1)]),_c('div',{staticClass:\"clear-btn\"},[_c('a-button',{attrs:{\"type\":\"link\"},on:{\"click\":function($event){return _vm.clearAll()}}},[_vm._v(\"清除全部\")])],1)])])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <div id=\"formulaPage\">\r\n        <!-- 公式编辑区域 -->\r\n        <div\r\n                class=\"formulaView\"\r\n                id=\"formulaView\"\r\n                ref=\"formulaView\"\r\n                @click.stop=\"recordPosition()\"\r\n        >\r\n            <div class=\"content-item\" v-for=\"(item,index) in formulaList\" :key=\"index\" @click.stop=\"recordPosition(index)\" >\r\n                <div class=\"num\" v-if=\"item.type == 'num'\" >\r\n                    &zwj;{{item.value}}\r\n                </div>\r\n                <div class=\"plain\" v-else-if=\"item.type == 'plain'\" >\r\n                    &zwj;{{item.value}}\r\n                </div>\r\n                <div class=\"obj\" v-else-if=\"item.type == 'obj'\" >\r\n                    &zwj;{{item.value}}\r\n                </div>\r\n                <!--光标-->\r\n                <div class=\"cursor\" v-if=\"item.cursor\" ></div>\r\n            </div>\r\n        </div>\r\n        <!-- 操作区域 -->\r\n        <div class=\"formula-controls mt_10\">\r\n            <!-- 运算符按钮组 -->\r\n            <div class=\"operator-group\">\r\n                <a-button \r\n                        v-for=\"item in operatorList\" \r\n                        :key=\"item.id\"\r\n                        class=\"operator-btn\"\r\n                        @click=\"addItem(item.id, 'plain')\"\r\n                >\r\n                    {{ item.name }}\r\n                </a-button>\r\n            </div>\r\n            <!-- 指标标签组 -->\r\n            <div class=\"data-tags\">\r\n                <div class=\"tag-group\">\r\n                    <a-tag\r\n                            v-for=\"item in dataList\"\r\n                            :key=\"item.id\"\r\n                            class=\"data-tag\"\r\n                            @click=\"addItem(item.id, 'obj')\"\r\n                    >\r\n                        {{ item.name }}\r\n                    </a-tag>\r\n                </div>\r\n            </div>\r\n            <!-- 清除按钮 -->\r\n            <div class=\"clear-btn\">\r\n                <a-button type=\"link\" @click=\"clearAll()\">清除全部</a-button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n  </template>\r\n  <script>\r\n    /**\r\n     * dataList 需要选择数据的集合\r\n     * defaultList 初始值的集合\r\n     * @change 比变更后回传的数据\r\n     * **/\r\n    export default {\r\n        name: '',\r\n        props:{\r\n            // dataList:{\r\n            //     type:Array,\r\n            //     default() {\r\n            //         return [\r\n            //         ];\r\n            //     },\r\n            // },\r\n            // defaultList:{\r\n            //     type:Array,\r\n            //     default() {\r\n            //         return [];\r\n            //     },\r\n            // },\r\n        },\r\n        data: function () {\r\n            return {\r\n                // 公式字符串\r\n                formulaStr:'',\r\n                dataId:'',\r\n                operatorId:'',\r\n                formulaList:[],\r\n                //运算符\r\n                operatorList:[\r\n                    {\r\n                        name:'+',\r\n                        id:'+'\r\n                    },\r\n                    {\r\n                        name:'-',\r\n                        id:'-'\r\n                    },\r\n                    {\r\n                        name:'*',\r\n                        id:'*'\r\n                    },\r\n                    {\r\n                        name:'/',\r\n                        id:'/'\r\n                    },\r\n                ],\r\n                dataList:[\r\n                    {\r\n                        name:'指标1',\r\n                        id:'1',\r\n                    },\r\n                    {\r\n                        name:'指标2',\r\n                        id:'2',\r\n                    },\r\n                    {\r\n                        name:'指标3',\r\n                        id:'3',\r\n                    },\r\n                ],\r\n                defaultList:[\r\n                    {\r\n                        name:'指标1',\r\n                        id:'1',\r\n                    },\r\n                ],\r\n                // 是否点击指标\r\n                isClickData:false,\r\n            }\r\n        },\r\n        watch:{\r\n            formulaList(val){\r\n                this.$emit('change',val)\r\n            }\r\n        },\r\n        created() {\r\n            //监听鼠标事件\r\n            this.$nextTick(function () {\r\n                document.addEventListener(\"keydown\", this.keydown, false);\r\n                document.addEventListener('click',this.formulaBlur);\r\n            });\r\n        },\r\n        destroyed () {\r\n            //移除监听事件\r\n            document.removeEventListener(\"keydown\", this.keydown, false);\r\n            document.removeEventListener('click',this.formulaBlur);\r\n        },\r\n        methods: {\r\n            // 获取\r\n            getFormula: function(){\r\n            },\r\n            // 点选时记录光标位置\r\n            recordPosition(index) {\r\n                if(this.formulaList && this.formulaList.length >0){\r\n                    this.formulaList = this.formulaList.map((item,itemIndex)=>{\r\n                        item.cursor = false;\r\n                        if(index > -1 && index == itemIndex){\r\n                            item.cursor = true;\r\n                        }else if((index!==0 && !index) && itemIndex == (this.formulaList.length -1)){\r\n                            item.cursor = true;\r\n                        }\r\n                        return item\r\n                    });\r\n                }else {\r\n                    this.formulaList = [\r\n                        {\r\n                            cursor:true,\r\n                            type:'placeholder',\r\n                            value:'',\r\n                        }\r\n                    ]\r\n                }\r\n                // this.$forceUpdate();\r\n            },\r\n            //失去焦点\r\n            formulaBlur(e){\r\n                  if(!this.isClickData){\r\n                      this.formulaList = this.formulaList?.map(item=>{\r\n                          item.cursor = false;\r\n                          return item\r\n                      })\r\n                  }\r\n            },\r\n            /**\r\n             * @returns {addItem<*, void, *>}\r\n             * 添加字段\r\n             * type obj 字段  num 数字 plain符号\r\n             * place 是否修改光标位置\r\n             */\r\n            addItem: function (val, type, place = true) {\r\n                if(!val) return false;\r\n  \r\n                // 添加焦点并\r\n                this.isClickData = type === 'obj';\r\n                setTimeout(() => {\r\n                  this.isClickData = false;\r\n                }, 100);\r\n                let that = this;\r\n                \r\n                // 处理指标添加\r\n                if(type === 'obj' && this.formulaList && this.formulaList.length > 0) {\r\n                    this.recordPosition(this.formulaList.length - 1);\r\n                    let cursorIndex = this.formulaList.findIndex(item => item.cursor);\r\n                    if(cursorIndex !== -1) {\r\n                        let prevItem = this.formulaList[cursorIndex];\r\n                        // 如果前一个元素不是运算符且不是占位符，先添加运算符\r\n                        if(prevItem && prevItem.type !== 'plain' && prevItem.type !== 'placeholder') {\r\n                            // 先在当前位置插入运算符\r\n                            let operatorData = {\r\n                                value: '-',\r\n                                key: '-',\r\n                                type: 'plain'\r\n                            };\r\n                            this.formulaList.splice(cursorIndex + 1, 0, operatorData);\r\n                            // 更新光标位置到运算符后\r\n                            this.recordPosition(cursorIndex + 1);\r\n                        }\r\n                    }\r\n                }\r\n                \r\n                //插入括号\r\n                if(type == 'plain' && val == '()'){\r\n                    val = '(';\r\n                    setTimeout(function () {\r\n                        that.addItem(')',type,false)\r\n                    },50)\r\n                }\r\n                let obj={},data = {\r\n                    value:'',\r\n                    key:val,\r\n                    type:type,\r\n                };\r\n                if(type == 'obj'){\r\n                    //获取数据 为 value 赋值\r\n                    obj = this.dataList?.find(item=>item.id == val);\r\n                    data.value = obj.name;\r\n                }else {\r\n                    data.value = val;\r\n                }\r\n                if(this.formulaList && this.formulaList.length>0){\r\n                    const length = this.formulaList.length;\r\n                    for (let i = 0; i < length; i++) {\r\n                        //查找光标位置 如果光标位置为空 则在最后添加\r\n                        if(this.formulaList[i].cursor){\r\n                            this.formulaList.splice(i+1,0,data);\r\n                            place && this.recordPosition(i+1);\r\n                            break;\r\n                        }else if(i === (this.formulaList.length - 1)){\r\n                            this.formulaList.push(data)\r\n                            this.recordPosition(this.formulaList.length - 1);\r\n                        }\r\n                    }\r\n                }else {\r\n                    if(!this.formulaList){\r\n                        this.formulaList = [];\r\n                    }\r\n                    this.formulaList.push(data);\r\n                    this.recordPosition(this.formulaList.length - 1);\r\n                }\r\n            },\r\n            //清除全部\r\n            clearAll(){\r\n                this.formulaList = [];\r\n                let that = this;\r\n                setTimeout(function () {\r\n                    that.recordPosition();\r\n                },100);\r\n            },\r\n            //删除\r\n            deleteItem(type){\r\n                let arr = JSON.parse(JSON.stringify(this.formulaList)),index = null;\r\n                const length = arr?.length;\r\n                for (let i = 0; i < length; i++) {\r\n                    if(arr[i].cursor && arr[i].key){\r\n                        index = i;\r\n                        if(type == 'del'){\r\n                            index = i + 1;\r\n                        }\r\n                        if(index > -1){\r\n                            this.formulaList.splice(index,1);\r\n                            if(type == 'del') {\r\n                            }else {\r\n                                this.recordPosition(index - 1);\r\n                            }\r\n                        }\r\n                        break;\r\n                    }\r\n                }\r\n            },\r\n            // 键盘输入\r\n            keydown(e){\r\n                //禁止输入\r\n                // 检测光标是否存在\r\n                let index,cursorData = this.formulaList?.find((item,itemIndex)=>{\r\n                    if(item.cursor){\r\n                        index = itemIndex\r\n                    }\r\n                    return item.cursor\r\n                });\r\n                if(!cursorData){\r\n                    return false;\r\n                }\r\n                //左右移动键控制光标位置\r\n                if (e && [37,39].includes(e.keyCode)){\r\n                    if(e.keyCode == 37){index = index - 1;}else {index = index + 1;}\r\n                    if(index > -1 && index < this.formulaList.length){\r\n                        this.recordPosition(index);\r\n                    }\r\n                }else if (e && e.keyCode == 8){\r\n                    //Backspace 键 删除前面的值\r\n                    this.deleteItem();\r\n                }else if (e && [107,109,106,111].includes(e.keyCode)){\r\n                    //运算符列表\r\n                    this.addItem(e.key,'plain')\r\n                }else if (e && e.shiftKey && [48,57].includes(e.keyCode) ){\r\n                    //括号\r\n                  //  if( e.keyCode == 48) e.key = ')';\r\n                  //  if( e.keyCode == 57) e.key = '(';\r\n                    this.addItem(e.key,'num')\r\n                }else if (e && e.keyCode == 46){\r\n                    //delete键删除光标后面的值\r\n                    this.deleteItem('del');\r\n                }else {\r\n                    document.returnValue = false;\r\n                    // 修改正则以允许输入0\r\n                    var tt = /^([0-9]{1}[0-9]{0,7})$/;  // 允许0-9的单个数字，后面可以跟0-7位数字\r\n                    if(tt.test(e.key)){\r\n                        //输入为数字 插入数字\r\n                        this.addItem(e.key,'num')\r\n                    }\r\n                }\r\n            },\r\n            /**\r\n             * 公式转为字符串\r\n             * 格式 [id]符号数字\r\n             * **/\r\n            parsingFormula: function(formulaStr){\r\n                let str = '',arr = [];\r\n                arr = this.formulaList?.map(item=>{\r\n                    let val = item.key;\r\n                    if(val){\r\n                        if(item.type == 'obj'){\r\n                            val = '['+val+']'\r\n                        }\r\n                        str = str+val;\r\n                    }\r\n                    return val\r\n                });\r\n                return str\r\n            },\r\n            /**\r\n             * 格式效验\r\n             * */\r\n            formatValidation(){\r\n                let objData = null;\r\n                let arr = this.formulaList?.filter(item=>{\r\n                    if(item.type == 'obj'){\r\n                        objData = item;\r\n                    }\r\n                    return item.key;\r\n                }),data = {type:true,mag:''};\r\n               if(!objData){\r\n                   data.mag = '至少添加一个指标';\r\n               }else {\r\n                   for (let i = 0; i < arr.length; i++) {\r\n                       if(i < arr.length-1){\r\n                           //判断当前类型\r\n                           if(arr[i].type == 'obj' && arr[i+1].type =='plain' ){\r\n                               //类型为obj时 后一个 需以 符号结尾\r\n                               data.mag = '指标后缀';\r\n                           }\r\n                       }\r\n                   }\r\n               }\r\n               if(data.mag){\r\n                   data.type = false;\r\n               }\r\n               return data;\r\n            },\r\n        }\r\n    }\r\n  </script>\r\n  <style lang=\"scss\">\r\n    #formulaPage {\r\n        .formulaView{\r\n            padding: 8px 12px;\r\n            width: 100%;\r\n            min-height: 120px;\r\n            border: 1px solid #d9d9d9;\r\n            border-radius: 2px;\r\n            line-height: 1.5715;\r\n            font-size: 14px;\r\n            background: #fff;\r\n            transition: all 0.3s;\r\n  \r\n            &:hover {\r\n                border-color: #40a9ff;\r\n            }\r\n  \r\n            &:focus-within {\r\n                border-color: #1890ff;\r\n                box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);\r\n            }\r\n  \r\n            .content-item{\r\n                position: relative;\r\n                height: 22px;\r\n                cursor: text;\r\n                user-select: none;\r\n                display: inline-flex;\r\n                align-items: center;\r\n                .cursor{\r\n                    height: 16px;\r\n                    width: 2px;\r\n                    background: #1890ff;\r\n                    animation:defaultCursor 1s steps(2) infinite;\r\n                    position: absolute;\r\n                    right: 0;\r\n                }\r\n                .obj {\r\n                    padding: 2px 8px;\r\n                    margin: 0 2px;\r\n                    background: #e6f7ff;\r\n                    border: 1px solid #91d5ff;\r\n                    border-radius: 2px;\r\n                    color: #1890ff;\r\n                    transition: all 0.3s;\r\n  \r\n                    &:hover {\r\n                        background: #bae7ff;\r\n                    }\r\n                }\r\n                .num{\r\n                    color: #262626;\r\n                    font-weight: 500;\r\n                }\r\n                .plain {\r\n                    color: #595959;\r\n                    padding: 0 2px;\r\n                    font-weight: 500;\r\n                }\r\n            }\r\n        }\r\n        .formula-controls {\r\n            padding: 16px;\r\n            background: #fafafa;\r\n            border: 1px solid #f0f0f0;\r\n            border-radius: 2px;\r\n            margin-top: 16px;\r\n            .operator-group {\r\n                margin-bottom: 16px;\r\n                .operator-btn {\r\n                    margin-right: 8px;\r\n                    min-width: 40px;\r\n                    height: 32px;\r\n                    &:last-child {\r\n                        margin-right: 0;\r\n                    }\r\n                }\r\n            }\r\n            .data-tags {\r\n                .tag-group {\r\n                    display: flex;\r\n                    flex-wrap: wrap;\r\n                    gap: 8px;\r\n                }\r\n                .data-tag {\r\n                    cursor: pointer;\r\n                    padding: 4px 8px;\r\n                    background: #f0f0f0;\r\n                    border: 1px solid #d9d9d9;\r\n                    transition: all 0.3s;\r\n                    &:hover {\r\n                        color: #1890ff;\r\n                        background: #e6f7ff;\r\n                        border-color: #91d5ff;\r\n                    }\r\n                }\r\n            }\r\n            .clear-btn {\r\n                margin-top: 16px;\r\n                text-align: right;\r\n                border-top: 1px solid #f0f0f0;\r\n                padding-top: 16px;\r\n            }\r\n        }\r\n    }\r\n    @keyframes defaultCursor {\r\n        0% {\r\n            opacity: 1;\r\n        }\r\n        100% {\r\n            opacity: 0;\r\n        }\r\n    }\r\n  </style>","import mod from \"-!../../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./formula-editor.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./formula-editor.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./formula-editor.vue?vue&type=template&id=2271bf40\"\nimport script from \"./formula-editor.vue?vue&type=script&lang=js\"\nexport * from \"./formula-editor.vue?vue&type=script&lang=js\"\nimport style0 from \"./formula-editor.vue?vue&type=style&index=0&id=2271bf40&prod&lang=scss\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","attrs","ref","staticClass","on","$event","stopPropagation","recordPosition","_l","item","index","key","type","_v","_s","value","_e","id","addItem","name","clearAll","staticRenderFns","props","data","formulaStr","dataId","operatorId","formulaList","operatorList","dataList","defaultList","isClickData","watch","val","$emit","created","$nextTick","document","addEventListener","keydown","formulaBlur","destroyed","removeEventListener","methods","getFormula","length","map","itemIndex","cursor","e","place","setTimeout","that","cursorIndex","findIndex","prevItem","operatorData","splice","obj","find","i","push","deleteItem","arr","JSON","parse","stringify","cursorData","includes","keyCode","shiftKey","returnValue","tt","test","parsingFormula","str","formatValidation","objData","filter","mag","component"],"sourceRoot":""}